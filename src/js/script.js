"use strict";function addEvent(element,evt,fnc){return element.addEventListener?element.addEventListener(evt,fnc,!1):element.attachEvent("on"+evt,fnc)}function swapClass(element,string,regex){""!==string?element.className=regex.test(element.className)?element.className.replace(regex,"")+" "+string:element.className+" "+string:element.className=element.className.replace(regex,"")}function removeEvent(element,evt,fnc){return element.removeEventListener?element.removeEventListener(evt,fnc,!1):element.detachEvent("on"+evt,fnc)}function revealText(event){var open=regOpened.test(this.parentNode.className);return this.innerHTML="",open?(this.parentNode.className=this.parentNode.className.replace(regOpened,""),this.appendChild(document.createTextNode("expand to full paragraph"))):(swapClass(this.parentNode,"opened",regOpened),this.appendChild(document.createTextNode("consolidate results"))),event.preventDefault?event.preventDefault():event.returnValue=!1,!1}function dataResponse(httpRequest,action){var reveals,rl,response=JSON.parse(httpRequest.responseText),content=response[0]||null,meta=response[1]||null,expires=new Date(Date.now()+36e5),a=0,b=0;if(content&&0===content.hits.total&&meta&&0===meta.hits.total)return app.isDone(!1);if(app.isDone(!0),expires=expires.toUTCString(),content){var currentContent=content.hits.hits.length;if(app.term_.innerHTML=app.term,app.total_.innerHTML=content.hits.total,app.placeContent=content._scroll_id,document.cookie="placeContent="+app.placeContent+"; expires="+expires,"more"!==action){var currentRelatives=content.aggregations.related_doc.buckets.length;for(window.scroll(0,0);currentContent>b;++b)app.scoresContent[b]=content.hits.hits[b]._score;for(b=0;currentRelatives>b;++b)app.scoresContent[b]=content.aggregations.related_doc.buckets[b].score;app.related_.innerHTML=app.addItem(content.aggregations.related_doc.buckets,app.relatedTemplate.textContent||app.relatedTemplate.innerText,app.scoresRelatives),app.results_.innerHTML=app.addItem(content.hits.hits,app.resultTemplate.textContent||app.resultTemplate.innerText,app.scoresContent),app.count_.innerHTML=currentContent,app.relatedRect=app.related_.getBoundingClientRect(),app.bodyRect=document.body.getBoundingClientRect(),app.stickyBarPosition=Math.abs(app.relatedRect.top)+Math.abs(app.bodyRect.top)+Math.abs(app.relatedRect.height)}else{var contentGathered=app.scoresContent.length;for(b=0;currentContent>b;++b)app.scoresContent[b+contentGathered]=content.hits.hits[b]._score;app.results_.innerHTML+=app.addItem(content.hits.hits,app.resultTemplate.textContent||app.resultTemplate.innerText,app.scoresContent),app.count_.innerHTML=app.scoresContent.length}for(reveals=document.querySelectorAll(".text > .reveal"),rl=reveals.length;rl>a;++a)addEvent(reveals[a],"click",revealText);content.hits.hits.length<20?(swapClass(app.moreContent_,"hidden",regHidden),app.loading.stillMore=!1):(swapClass(app.moreContent_,"",regHidden),app.loading.stillMore=!0)}meta&&(app.placeMeta=meta._scroll_id,document.cookie="placeMeta="+app.placeMeta+"; expires="+expires),app.resultsRect=app.results_.getBoundingClientRect(),app.loading.currentHeight=Math.abs(app.resultsRect.height)}function sendData(responder,query,type,action,spot,dot,clbk){var httpRequest=new XMLHttpRequest,url=("https:"==document.location.protocol?"https://that.pub/find/":"http://find.that.pub/")+type+"/"+action;httpRequest.onreadystatechange=function(){4===httpRequest.readyState&&200===httpRequest.status&&(responder(httpRequest,action),clbk("more"===action?null:""))},httpRequest.open("POST",url,!0),httpRequest.setRequestHeader("Content-type","application/json"),httpRequest.send(JSON.stringify({t:app.querySetup(query),g:spot,s:dot}))}function more(event){return event.preventDefault(),swapClass(app.loader_,"loading",regLoad),sendData(dataResponse,document.cookie.placeContent||app.placeContent?"":app.term,"content","more",document.cookie.placeContent||app.placeContent,null,endLoading),!1}function modalClose(event){event.target===event.currentTarget&&app.searchToggle("hidden")}function scrollWheeler(){var t=document.documentElement||document.body.parentNode,pos=(t&&"number"==typeof t.ScrollTop?t:document.body).ScrollTop||window.pageYOffset,delta=pos-app.pos;app.infiniScroll===!0&&app.loading.now===!1&&app.loading.stillMore===!0&&delta>0&&pos>app.loading.currentHeight-1200&&(app.loading.now=!0,more()),app.pos=pos}function infini(){var status;app.infiniScroll=this.checked||!!this.checked,status=app.infiniScroll?"enabled":"disabled",app.infiniLabel_.className=status,app.infiniLabel_.setAttribute("title","Infinite scroll "+status),status||this.removeAttribute("checked")}function endLoading(el){el=null===el?app.moreContent_:""===el?app.send_:null,swapClass(app.loader_,"",regLoad),app.loading.now=!1,el==app.send_&&app.searchToggle("hidden")}(function(){function baseIndexOf(array,value,fromIndex){if(value!==value)return indexOfNaN(array,fromIndex);for(var index=(fromIndex||0)-1,length=array.length;++index<length;)if(array[index]===value)return index;return-1}function baseToString(value){return"string"==typeof value?value:null==value?"":value+""}function charsLeftIndex(string,chars){for(var index=-1,length=string.length;++index<length&&chars.indexOf(string.charAt(index))>-1;);return index}function charsRightIndex(string,chars){for(var index=string.length;index--&&chars.indexOf(string.charAt(index))>-1;);return index}function escapeHtmlChar(chr){return htmlEscapes[chr]}function escapeStringChar(chr){return"\\"+stringEscapes[chr]}function indexOfNaN(array,fromIndex,fromRight){for(var length=array.length,index=fromRight?fromIndex||length:(fromIndex||0)-1;fromRight?index--:++index<length;){var other=array[index];if(other!==other)return index}return-1}function isObjectLike(value){return value&&"object"==typeof value||!1}function isSpace(charCode){return 160>=charCode&&charCode>=9&&13>=charCode||32==charCode||160==charCode||5760==charCode||6158==charCode||charCode>=8192&&(8202>=charCode||8232==charCode||8233==charCode||8239==charCode||8287==charCode||12288==charCode||65279==charCode)}function trimmedLeftIndex(string){for(var index=-1,length=string.length;++index<length&&isSpace(string.charCodeAt(index)););return index}function trimmedRightIndex(string){for(var index=string.length;index--&&isSpace(string.charCodeAt(index)););return index}function lodash(){}function arrayEach(array,iteratee){for(var index=-1,length=array.length;++index<length&&iteratee(array[index],index,array)!==!1;);return array}function assignOwnDefaults(objectValue,sourceValue,key,object){return"undefined"!=typeof objectValue&&hasOwnProperty.call(object,key)?objectValue:sourceValue}function baseAssign(object,source,customizer){var props=keys(source);if(!customizer)return baseCopy(source,object,props);for(var index=-1,length=props.length;++index<length;){var key=props[index],value=object[key],result=customizer(value,source[key],key,object,source);(result===result?result===value:value!==value)&&("undefined"!=typeof value||key in object)||(object[key]=result)}return object}function baseCopy(source,object,props){props||(props=object,object={});for(var index=-1,length=props.length;++index<length;){var key=props[index];object[key]=source[key]}return object}function baseSlice(array,start,end){var index=-1,length=array.length;start=null==start?0:+start||0,0>start&&(start=-start>length?0:length+start),end="undefined"==typeof end||end>length?length:+end||0,0>end&&(end+=length),length=start>end?0:end-start>>>0,start>>>=0;for(var result=Array(length);++index<length;)result[index]=array[index+start];return result}function baseValues(object,props){for(var index=-1,length=props.length,result=Array(length);++index<length;)result[index]=object[props[index]];return result}function binaryIndex(array,value,retHighest){var low=0,high=array?array.length:low;if("number"==typeof value&&value===value&&HALF_MAX_ARRAY_LENGTH>=high){for(;high>low;){var mid=low+high>>>1,computed=array[mid];(retHighest?value>=computed:value>computed)?low=mid+1:high=mid}return high}return binaryIndexBy(array,value,identity,retHighest)}function binaryIndexBy(array,value,iteratee,retHighest){value=iteratee(value);for(var low=0,high=array?array.length:0,valIsNaN=value!==value,valIsUndef="undefined"==typeof value;high>low;){var mid=floor((low+high)/2),computed=iteratee(array[mid]),isReflexive=computed===computed;if(valIsNaN)var setLow=isReflexive||retHighest;else setLow=valIsUndef?isReflexive&&(retHighest||"undefined"!=typeof computed):retHighest?value>=computed:value>computed;setLow?low=mid+1:high=mid}return nativeMin(high,MAX_ARRAY_INDEX)}function getIndexOf(collection,target,fromIndex){var result=lodash.indexOf||indexOf;return result=result===indexOf?baseIndexOf:result,collection?result(collection,target,fromIndex):result}function isIndex(value,length){return value=+value,length=null==length?MAX_SAFE_INTEGER:length,value>-1&&value%1==0&&length>value}function isIterateeCall(value,index,object){if(!isObject(object))return!1;var type=typeof index;if("number"==type)var length=object.length,prereq=isLength(length)&&isIndex(index,length);else prereq="string"==type&&index in object;return prereq&&object[index]===value}function isLength(value){return"number"==typeof value&&value>-1&&value%1==0&&MAX_SAFE_INTEGER>=value}function shimKeys(object){for(var props=keysIn(object),propsLength=props.length,length=propsLength&&object.length,support=lodash.support,allowIndexes=length&&isLength(length)&&(isArray(object)||support.nonEnumStrings&&isString(object)||support.nonEnumArgs&&isArguments(object)),index=-1,result=[];++index<propsLength;){var key=props[index];(allowIndexes&&isIndex(key,length)||hasOwnProperty.call(object,key))&&result.push(key)}return result}function indexOf(array,value,fromIndex){var length=array?array.length:0;if(!length)return-1;if("number"==typeof fromIndex)fromIndex=0>fromIndex?nativeMax(length+fromIndex,0):fromIndex||0;else if(fromIndex){var index=binaryIndex(array,value),other=array[index];return(value===value?value===other:other!==other)?index:-1}return baseIndexOf(array,value,fromIndex)}function includes(collection,target,fromIndex){var length=collection?collection.length:0;return isLength(length)||(collection=values(collection),length=collection.length),length?(fromIndex="number"==typeof fromIndex?0>fromIndex?nativeMax(length+fromIndex,0):fromIndex||0:0,"string"==typeof collection||!isArray(collection)&&isString(collection)?length>fromIndex&&collection.indexOf(target,fromIndex)>-1:getIndexOf(collection,target,fromIndex)>-1):!1}function isArguments(value){var length=isObjectLike(value)?value.length:undefined;return isLength(length)&&objToString.call(value)==argsTag||!1}function isError(value){return isObjectLike(value)&&"string"==typeof value.message&&objToString.call(value)==errorTag||!1}function isFunction(value){return"function"==typeof value||!1}function isObject(value){var type=typeof value;return"function"==type||value&&"object"==type||!1}function isNative(value){return null==value?!1:objToString.call(value)==funcTag?reNative.test(fnToString.call(value)):isObjectLike(value)&&(isHostObject(value)?reNative:reHostCtor).test(value)||!1}function isNumber(value){return"number"==typeof value||isObjectLike(value)&&objToString.call(value)==numberTag||!1}function isRegExp(value){return isObject(value)&&objToString.call(value)==regexpTag||!1}function isString(value){return"string"==typeof value||isObjectLike(value)&&objToString.call(value)==stringTag||!1}function keysIn(object){if(null==object)return[];isObject(object)||(object=Object(object));var length=object.length,support=lodash.support;length=length&&isLength(length)&&(isArray(object)||support.nonEnumStrings&&isString(object)||support.nonEnumArgs&&isArguments(object))&&length||0;for(var Ctor=object.constructor,index=-1,proto=isFunction(Ctor)&&Ctor.prototype||objectProto,isProto=proto===object,result=Array(length),skipIndexes=length>0,skipErrorProps=support.enumErrorProps&&(object===errorProto||object instanceof Error),skipProto=support.enumPrototypes&&isFunction(object);++index<length;)result[index]=index+"";for(var key in object)skipProto&&"prototype"==key||skipErrorProps&&("message"==key||"name"==key)||skipIndexes&&isIndex(key,length)||"constructor"==key&&(isProto||!hasOwnProperty.call(object,key))||result.push(key);if(support.nonEnumShadows&&object!==objectProto){var tag=object===stringProto?stringTag:object===errorProto?errorTag:objToString.call(object),nonEnums=nonEnumProps[tag]||nonEnumProps[objectTag];for(tag==objectTag&&(proto=objectProto),length=shadowProps.length;length--;){key=shadowProps[length];var nonEnum=nonEnums[key];isProto&&nonEnum||(nonEnum?!hasOwnProperty.call(object,key):object[key]===proto[key])||result.push(key)}}return result}function values(object){return baseValues(object,keys(object))}function escape(string){return string=baseToString(string),string&&reHasUnescapedHtml.test(string)?string.replace(reUnescapedHtml,escapeHtmlChar):string}function escapeRegExp(string){return string=baseToString(string),string&&reHasRegExpChars.test(string)?string.replace(reRegExpChars,"\\$&"):string}function template(string,options,otherOptions){var settings=lodash.templateSettings;otherOptions&&isIterateeCall(string,options,otherOptions)&&(options=otherOptions=null),string=baseToString(string),options=baseAssign(baseAssign({},otherOptions||options),settings,assignOwnDefaults);var isEscaping,isEvaluating,imports=baseAssign(baseAssign({},options.imports),settings.imports,assignOwnDefaults),importsKeys=keys(imports),importsValues=baseValues(imports,importsKeys),index=0,interpolate=options.interpolate||reNoMatch,source="__p += '",reDelimiters=RegExp((options.escape||reNoMatch).source+"|"+interpolate.source+"|"+(interpolate===reInterpolate?reEsTemplate:reNoMatch).source+"|"+(options.evaluate||reNoMatch).source+"|$","g"),sourceURL="//# sourceURL="+("sourceURL"in options?options.sourceURL:"lodash.templateSources["+ ++templateCounter+"]")+"\n";string.replace(reDelimiters,function(match,escapeValue,interpolateValue,esTemplateValue,evaluateValue,offset){return interpolateValue||(interpolateValue=esTemplateValue),source+=string.slice(index,offset).replace(reUnescapedString,escapeStringChar),escapeValue&&(isEscaping=!0,source+="' +\n__e("+escapeValue+") +\n'"),evaluateValue&&(isEvaluating=!0,source+="';\n"+evaluateValue+";\n__p += '"),interpolateValue&&(source+="' +\n((__t = ("+interpolateValue+")) == null ? '' : __t) +\n'"),index=offset+match.length,match}),source+="';\n";var variable=options.variable;variable||(source="with (obj) {\n"+source+"\n}\n"),source=(isEvaluating?source.replace(reEmptyStringLeading,""):source).replace(reEmptyStringMiddle,"$1").replace(reEmptyStringTrailing,"$1;"),source="function("+(variable||"obj")+") {\n"+(variable?"":"obj || (obj = {});\n")+"var __t, __p = ''"+(isEscaping?", __e = _.escape":"")+(isEvaluating?", __j = Array.prototype.join;\nfunction print() { __p += __j.call(arguments, '') }\n":";\n")+source+"return __p\n}";var result=attempt(function(){return Function(importsKeys,sourceURL+"return "+source).apply(undefined,importsValues)});if(result.source=source,isError(result))throw result;return result}function trim(string,chars,guard){var value=string;return(string=baseToString(string))?(guard?isIterateeCall(value,chars,guard):null==chars)?string.slice(trimmedLeftIndex(string),trimmedRightIndex(string)+1):(chars+="",string.slice(charsLeftIndex(string,chars),charsRightIndex(string,chars)+1)):string}function trunc(string,options,guard){guard&&isIterateeCall(string,options,guard)&&(options=null);var length=DEFAULT_TRUNC_LENGTH,omission=DEFAULT_TRUNC_OMISSION;if(null!=options)if(isObject(options)){var separator="separator"in options?options.separator:separator;length="length"in options?+options.length||0:length,omission="omission"in options?baseToString(options.omission):omission}else length=+options||0;if(string=baseToString(string),length>=string.length)return string;var end=length-omission.length;if(1>end)return omission;var result=string.slice(0,end);if(null==separator)return result+omission;if(isRegExp(separator)){if(string.slice(end).search(separator)){var match,newEnd,substring=string.slice(0,end);for(separator.global||(separator=RegExp(separator.source,(reFlags.exec(separator)||"")+"g")),separator.lastIndex=0;match=separator.exec(substring);)newEnd=match.index;result=result.slice(0,null==newEnd?end:newEnd)}}else if(string.indexOf(separator,end)!=end){var index=result.lastIndexOf(separator);index>-1&&(result=result.slice(0,index))}return result+omission}function attempt(func){try{return func.apply(undefined,baseSlice(arguments,1))}catch(e){return isError(e)?e:new Error(e)}}function identity(value){return value}var undefined,VERSION="3.2.0",DEFAULT_TRUNC_LENGTH=30,DEFAULT_TRUNC_OMISSION="...",argsTag="[object Arguments]",arrayTag="[object Array]",boolTag="[object Boolean]",dateTag="[object Date]",errorTag="[object Error]",funcTag="[object Function]",numberTag="[object Number]",objectTag="[object Object]",regexpTag="[object RegExp]",stringTag="[object String]",reEmptyStringLeading=/\b__p \+= '';/g,reEmptyStringMiddle=/\b(__p \+=) '' \+/g,reEmptyStringTrailing=/(__e\(.*?\)|\b__t\)) \+\n'';/g,reUnescapedHtml=/[&<>"'`]/g,reHasUnescapedHtml=RegExp(reUnescapedHtml.source),reEscape=/<%-([\s\S]+?)%>/g,reEvaluate=/<%([\s\S]+?)%>/g,reInterpolate=/<%=([\s\S]+?)%>/g,reEsTemplate=/\$\{([^\\}]*(?:\\.[^\\}]*)*)\}/g,reFlags=/\w*$/,reHostCtor=/^\[object .+?Constructor\]$/,reNoMatch=/($^)/,reRegExpChars=/[.*+?^${}()|[\]\/\\]/g,reHasRegExpChars=RegExp(reRegExpChars.source),reThis=/\bthis\b/,reUnescapedString=/['\n\r\u2028\u2029\\]/g,shadowProps=["constructor","hasOwnProperty","isPrototypeOf","propertyIsEnumerable","toLocaleString","toString","valueOf"],templateCounter=-1,htmlEscapes={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#39;","`":"&#96;"},objectTypes={function:!0,object:!0},stringEscapes={"\\":"\\","'":"'","\n":"n","\r":"r","\u2028":"u2028","\u2029":"u2029"},root=objectTypes[typeof window]&&window!==(this&&this.window)?window:this,freeExports=objectTypes[typeof exports]&&exports&&!exports.nodeType&&exports,freeModule=objectTypes[typeof module]&&module&&!module.nodeType&&module,freeGlobal=freeExports&&freeModule&&"object"==typeof global&&global;!freeGlobal||freeGlobal.global!==freeGlobal&&freeGlobal.window!==freeGlobal&&freeGlobal.self!==freeGlobal||(root=freeGlobal);var moduleExports=freeModule&&freeModule.exports===freeExports&&freeExports,isHostObject=function(){try{Object({toString:0}+"")}catch(e){return function(){return!1}}return function(value){return"function"!=typeof value.toString&&"string"==typeof(value+"")}}(),arrayProto=Array.prototype,errorProto=Error.prototype,objectProto=Object.prototype,stringProto=String.prototype,fnToString=Function.prototype.toString,hasOwnProperty=objectProto.hasOwnProperty,objToString=objectProto.toString,reNative=RegExp("^"+escapeRegExp(objToString).replace(/toString|(function).*?(?=\\\()| for .+?(?=\\\])/g,"$1.*?")+"$"),floor=Math.floor,propertyIsEnumerable=objectProto.propertyIsEnumerable,splice=arrayProto.splice,Uint8Array=isNative(Uint8Array=root.Uint8Array)&&Uint8Array,nativeIsArray=isNative(nativeIsArray=Array.isArray)&&nativeIsArray,nativeKeys=isNative(nativeKeys=Object.keys)&&nativeKeys,nativeMax=Math.max,nativeMin=Math.min,MAX_ARRAY_LENGTH=Math.pow(2,32)-1,MAX_ARRAY_INDEX=MAX_ARRAY_LENGTH-1,HALF_MAX_ARRAY_LENGTH=MAX_ARRAY_LENGTH>>>1,MAX_SAFE_INTEGER=Math.pow(2,53)-1,nonEnumProps={};nonEnumProps[arrayTag]=nonEnumProps[dateTag]=nonEnumProps[numberTag]={constructor:!0,toLocaleString:!0,toString:!0,valueOf:!0},nonEnumProps[boolTag]=nonEnumProps[stringTag]={constructor:!0,toString:!0,valueOf:!0},nonEnumProps[errorTag]=nonEnumProps[funcTag]=nonEnumProps[regexpTag]={constructor:!0,toString:!0},nonEnumProps[objectTag]={constructor:!0},arrayEach(shadowProps,function(key){for(var tag in nonEnumProps)if(hasOwnProperty.call(nonEnumProps,tag)){var props=nonEnumProps[tag];props[key]=hasOwnProperty.call(props,key)}});var support=lodash.support={};!function(x){var Ctor=function(){this.x=1},object={0:1,length:1},props=[];Ctor.prototype={valueOf:1,y:1};for(var key in new Ctor)props.push(key);support.argsTag=objToString.call(arguments)==argsTag,support.enumErrorProps=propertyIsEnumerable.call(errorProto,"message")||propertyIsEnumerable.call(errorProto,"name"),support.enumPrototypes=propertyIsEnumerable.call(Ctor,"prototype"),support.funcDecomp=!isNative(root.WinRTError)&&reThis.test(function(){return this}),support.funcNames="string"==typeof Function.name,support.nonEnumStrings=!propertyIsEnumerable.call("x",0),support.nonEnumShadows=!/valueOf/.test(props),support.spliceObjects=(splice.call(object,0,1),!object[0]),support.unindexedChars="x"[0]+Object("x")[0]!="xx";try{support.nonEnumArgs=!propertyIsEnumerable.call(arguments,1)}catch(e){support.nonEnumArgs=!0}}(0,0),lodash.templateSettings={escape:reEscape,evaluate:reEvaluate,interpolate:reInterpolate,variable:"",imports:{_:lodash}},support.argsTag||(isArguments=function(value){var length=isObjectLike(value)?value.length:undefined;return isLength(length)&&hasOwnProperty.call(value,"callee")&&!propertyIsEnumerable.call(value,"callee")||!1});var isArray=nativeIsArray||function(value){return isObjectLike(value)&&isLength(value.length)&&objToString.call(value)==arrayTag||!1};(isFunction(/x/)||Uint8Array&&!isFunction(Uint8Array))&&(isFunction=function(value){return objToString.call(value)==funcTag});var keys=nativeKeys?function(object){if(object)var Ctor=object.constructor,length=object.length;return"function"==typeof Ctor&&Ctor.prototype===object||("function"==typeof object?lodash.support.enumPrototypes:length&&isLength(length))?shimKeys(object):isObject(object)?nativeKeys(object):[]}:shimKeys;lodash.keys=keys,lodash.keysIn=keysIn,lodash.values=values,lodash.attempt=attempt,lodash.escape=escape,lodash.escapeRegExp=escapeRegExp,lodash.identity=identity,lodash.includes=includes,lodash.indexOf=indexOf,lodash.isArguments=isArguments,lodash.isArray=isArray,lodash.isError=isError,lodash.isFunction=isFunction,lodash.isNative=isNative,lodash.isNumber=isNumber,lodash.isObject=isObject,lodash.isRegExp=isRegExp,lodash.isString=isString,lodash.template=template,lodash.trim=trim,lodash.trunc=trunc,lodash.contains=includes,lodash.include=includes,lodash.VERSION=VERSION,"function"==typeof define&&"object"==typeof define.amd&&define.amd?(root._=lodash,define(function(){return lodash})):freeExports&&freeModule?moduleExports?(freeModule.exports=lodash)._=lodash:freeExports._=lodash:root._=lodash}).call(this),function(root,factory){if("function"==typeof define&&define.amd)define([],factory);else if("object"==typeof exports){var randomColor=factory();"object"==typeof module&&module&&module.exports&&(exports=module.exports=randomColor),exports.randomColor=randomColor}else root.randomColor=factory()}(this,function(){function pickHue(options){var hueRange=getHueRange(options.hue),hue=randomWithin(hueRange);return 0>hue&&(hue=360+hue),hue}function pickSaturation(hue,options){if("random"===options.luminosity)return randomWithin([0,100]);if("monochrome"===options.hue)return 0;var saturationRange=getSaturationRange(hue),sMin=saturationRange[0],sMax=saturationRange[1];switch(options.luminosity){case"bright":sMin=55;break;case"dark":sMin=sMax-10;break;case"light":sMax=55}return randomWithin([sMin,sMax])}function pickBrightness(H,S,options){var bMin=getMinimumBrightness(H,S),bMax=100;switch(options.luminosity){case"dark":bMax=bMin+20;break;case"light":bMin=(bMax+bMin)/2;break;case"random":bMin=0,bMax=100}return randomWithin([bMin,bMax])}function setFormat(hsv,options){switch(options.format){case"hsvArray":return hsv;case"hslArray":return HSVtoHSL(hsv);case"hsl":var hsl=HSVtoHSL(hsv);return"hsl("+hsl[0]+", "+hsl[1]+"%, "+hsl[2]+"%)";case"rgbArray":return HSVtoRGB(hsv);case"rgb":var rgb=HSVtoRGB(hsv);return"rgb("+rgb.join(", ")+")";default:return HSVtoHex(hsv)}}function getMinimumBrightness(H,S){for(var lowerBounds=getColorInfo(H).lowerBounds,i=0;i<lowerBounds.length-1;i++){var s1=lowerBounds[i][0],v1=lowerBounds[i][1],s2=lowerBounds[i+1][0],v2=lowerBounds[i+1][1];if(S>=s1&&s2>=S){var m=(v2-v1)/(s2-s1),b=v1-m*s1;return m*S+b}}return 0}function getHueRange(colorInput){if("number"==typeof parseInt(colorInput)){var number=parseInt(colorInput);if(360>number&&number>0)return[number,number]}if("string"==typeof colorInput&&colorDictionary[colorInput]){var color=colorDictionary[colorInput];if(color.hueRange)return color.hueRange}return[0,360]}function getSaturationRange(hue){return getColorInfo(hue).saturationRange}function getColorInfo(hue){hue>=334&&360>=hue&&(hue-=360);for(var colorName in colorDictionary){var color=colorDictionary[colorName];if(color.hueRange&&hue>=color.hueRange[0]&&hue<=color.hueRange[1])return colorDictionary[colorName]}return"Color not found"}function randomWithin(range){return Math.floor(range[0]+Math.random()*(range[1]+1-range[0]))}function HSVtoHex(hsv){function componentToHex(c){var hex=c.toString(16);return 1==hex.length?"0"+hex:hex}var rgb=HSVtoRGB(hsv),hex="#"+componentToHex(rgb[0])+componentToHex(rgb[1])+componentToHex(rgb[2]);return hex}function defineColor(name,hueRange,lowerBounds){var sMin=lowerBounds[0][0],sMax=lowerBounds[lowerBounds.length-1][0],bMin=lowerBounds[lowerBounds.length-1][1],bMax=lowerBounds[0][1];colorDictionary[name]={hueRange:hueRange,lowerBounds:lowerBounds,saturationRange:[sMin,sMax],brightnessRange:[bMin,bMax]}}function loadColorBounds(){defineColor("monochrome",null,[[0,0],[100,0]]),defineColor("red",[-26,18],[[20,100],[30,92],[40,89],[50,85],[60,78],[70,70],[80,60],[90,55],[100,50]]),defineColor("orange",[19,46],[[20,100],[30,93],[40,88],[50,86],[60,85],[70,70],[100,70]]),defineColor("yellow",[47,62],[[25,100],[40,94],[50,89],[60,86],[70,84],[80,82],[90,80],[100,75]]),defineColor("green",[63,178],[[30,100],[40,90],[50,85],[60,81],[70,74],[80,64],[90,50],[100,40]]),defineColor("blue",[179,257],[[20,100],[30,86],[40,80],[50,74],[60,60],[70,52],[80,44],[90,39],[100,35]]),defineColor("purple",[258,282],[[20,100],[30,87],[40,79],[50,70],[60,65],[70,59],[80,52],[90,45],[100,42]]),defineColor("pink",[283,334],[[20,100],[30,90],[40,86],[60,84],[80,80],[90,75],[100,73]])}function HSVtoRGB(hsv){var h=hsv[0];0===h&&(h=1),360===h&&(h=359),h/=360;var s=hsv[1]/100,v=hsv[2]/100,h_i=Math.floor(6*h),f=6*h-h_i,p=v*(1-s),q=v*(1-f*s),t=v*(1-(1-f)*s),r=256,g=256,b=256;switch(h_i){case 0:r=v,g=t,b=p;break;case 1:r=q,g=v,b=p;break;case 2:r=p,g=v,b=t;break;case 3:r=p,g=q,b=v;break;case 4:r=t,g=p,b=v;break;case 5:r=v,g=p,b=q}var result=[Math.floor(255*r),Math.floor(255*g),Math.floor(255*b)];return result}function HSVtoHSL(hsv){var h=hsv[0],s=hsv[1]/100,v=hsv[2]/100,k=(2-s)*v;return[h,Math.round(s*v/(1>k?k:2-k)*1e4)/100,k/2*100]}var colorDictionary={};loadColorBounds();var randomColor=function(options){options=options||{};var H,S,B;if(null!=options.count){var totalColors=options.count,colors=[];for(options.count=null;totalColors>colors.length;)colors.push(randomColor(options));return options.count=totalColors,colors}return H=pickHue(options),S=pickSaturation(H,options),B=pickBrightness(H,S,options),setFormat([H,S,B],options)};return randomColor});var regPubMatch=/productNo(?:\.exact|\.raw)?(?=\:|$)/,regEmerge=/ ?emerge/g,regHidden=/ ?hidden/g,regLoad=/ ?loading/g,regSelected=/ ?selected/g,regFiltered=/ ?filtered/g,regOpened=/ ?opened/g,regDone=/ ?done|$/gm,regFail=/ ?failed/g;String.prototype.toTitle=function(){return this.replace(/(?:\W?)\w\S*/g,function(txt){return txt.charAt(0).toUpperCase()+txt.substr(1).toLowerCase()})},String.prototype.toPubName=function(){var removed,count=0,extraction=[],regQueryPubName=/(?:\b[\-_a-zA-Z]{1,3})?[ \t\-]*(?:(?:[\.\-]|[0-9]+)+)+(?:_?(?:sup|SUP)[A-Za-z]*)?/g,regEOLDashCheck=/[\-\cI\v\0\f]$/m;return removed=this.replace(regQueryPubName,function(txt){return extraction&&extraction.length>0&&regEOLDashCheck.test(extraction[count-1])?extraction[count-1]+=txt.toUpperCase().replace(/\s/g,""):extraction.push(txt.toUpperCase().replace(/\s/g,"")),count+=1,""}),{extract:extraction,remove:removed}},window.downloader=function(el){var link=document.createElement("a"),file=el.href||el.getAttribute("href")||"";if(""===file)return!1;link.download=el.download||el.getAttribute("download"),link.href=file,link.target="_blank";try{link.click()}catch(e){try{window.open(file)}catch(ee){window.location.href=file}}return!1};var App=function(){function filterOutliers(someArray){var values=someArray.concat();values.sort(function(a,b){return a-b});var q1=values[Math.floor(values.length/4)],q3=values[Math.ceil(.75*values.length)],iqr=q3-q1,maxValue=q3+1.5*iqr;return values.filter(function(x){return x>maxValue})}var bodyRect,relatedRect,resultsRect,relatedOffsetTop,stickyBarPosition,months={"01":"Jan","02":"Feb","03":"Mar","04":"Apr","05":"May","06":"Jun","07":"Jul","08":"Aug","09":"Sep",10:"Oct",11:"Nov",12:"Dec"},wrap_=document.getElementById("wrap"),searchWrap_=document.getElementById("search-wrap"),searchRestore_=document.getElementById("search-restore"),page_=document.getElementById("page"),results_=document.getElementById("results"),summary_=document.getElementById("summary"),count_=document.getElementById("count"),term_=document.getElementById("term"),total_=document.getElementById("total"),query_=document.getElementById("query"),send_=document.getElementById("send"),moreMeta_=document.getElementById("more-meta"),moreContent_=document.getElementById("more-content"),related_=document.getElementById("related"),infiniLabel_=document.getElementById("infini-label"),infiniScroll_=document.getElementById("infini-scroll"),infiniStatus_=document.getElementById("infini-status"),loader_=document.getElementById("loader"),placeContent=document.cookie.placeContent||"",placeMeta=document.cookie.placeMeta||"";return CSSStyleSheet.prototype.addCSSRule=function(selector,rules,index){"insertRule"in this?this.insertRule(selector+"{"+rules+"}",index):"addRule"in this&&this.addRule(selector,rules,index)},{wrap_:wrap_,searchWrap_:searchWrap_,searchRestore_:searchRestore_,page_:page_,results_:results_,summary_:summary_,count_:count_,term_:term_,total_:total_,query_:query_,send_:send_,moreMeta_:moreMeta_,moreContent_:moreContent_,related_:related_,placeContent:placeContent,placeMeta:placeMeta,infiniLabel_:infiniLabel_,infiniScroll_:infiniScroll_,infiniStatus_:infiniStatus_,loader_:loader_,infiniScroll:!0,done:!1,loading:{now:!1,stillMore:!1,currentHeight:0},bodyRect:bodyRect,relatedRect:relatedRect,resultsRect:resultsRect,relatedOffsetTop:relatedOffsetTop,stickyBarPosition:stickyBarPosition,traveling:!1,pos:0,term:"",scoresContent:[],scoresRelatives:[],selectedResults:[],selectedTotal:0,colors:{},dataRender:function(data,allScores){var index,group,number,fullPub,rawText,text,date,highlights,fileFormat,output={},regType=/chapter|section/;return!data._source&&data.key&&data.score?(index=_.indexOf(allScores,data.score),group=index>-1?" match-"+index:"",app.colors[data.key]=index,output={url:("https:"==document.location.protocol?"https://that.pub/get/":"http://get.that.pub/")+data.key.toLowerCase()+".pdf",key:data.key,score:data.score,gravitas:_.contains(filterOutliers(allScores),data.score)||data.score>=1?" pretty"+group:" boring"+group}):data._source.text&&(number=data._source.number,text=data.highlight["text.english2"],rawText=data._source.text,fullPub=data._source.productNo,highlights=Object.keys(data.highlight),fileFormat="form"!==data._type?".pdf":".xfdl",regPubMatch.test(highlights.join(":"))&&(fullPub=data.highlight["productNo.exact"]||data.highlight["productNo.raw"]||data.highlight.productNo,fullPub=fullPub.shift()),date=data._source.releaseDate?data._source.releaseDate.substring(6,8)+" "+months[data._source.releaseDate.substring(4,6)]+" "+data._source.releaseDate.substring(0,4):data._source.publishedDate.substring(0,2)+" "+months[data._source.publishedDate.substring(2,4)]+" "+data._source.publishedDate.substring(4,8),
regType.test(data._type)&&7==data._type.length&&(number=data._type.toTitle()+" "+data._source.number),index=app.colors[data._source.productNo||data._source.pubName],group=_.isNumber(index)&&(index>=0||5>index)?" match-"+index:"",output={score:data._score,gravitas:_.contains(filterOutliers(allScores),data._score)||data._score>=1?" pretty"+group:" boring"+group,date:date,url:("https:"==document.location.protocol?"https://that.pub/get/":"http://get.that.pub/")+data._source.productNo.toLowerCase()+fileFormat,fullPub:fullPub,title:data.highlight.title||data._source.title||null,rawTitle:data._source.title,sub:rawText?number:"",details:{chapter:data._source.chapter&&data._source.chapter.number||null,chapterTitle:data.highlight["chapter.title"]||data._source.chapter&&data._source.chapter.title||null,section:data._source.section&&data._source.section.number||null,sectionTitle:data.highlight["section.title"]||data._source.section&&data._source.section.title||null},rawText:rawText,concatText:data.highlight.text&&data.highlight.text[0]||null,parts:Array.isArray(text)?text:null,fileFormat:fileFormat,type:rawText?" content":" doc"}),output||null},querySetup:function(term){return function(name){return{term:term,pubName:name.extract,noPubName:name.remove}}(term.toPubName())},addItem:function(results,templateCode,allScores){for(var tmp="",that=this,rl=results.length,a=0;rl>a;++a)tmp+=_.template(templateCode)(that.dataRender(results[a],allScores));return tmp},searchToggle:function(visibility){var screenHeight=window.innerHeight;"hidden"===visibility?(snabbt(this.searchWrap_,{position:[0,-screenHeight,0],easing:"easeOut",duration:150}),snabbt(this.wrap_,{opacity:1,fromOpacity:.5,easing:"easeOut",delay:150}),swapClass(document.body,"",regEmerge),removeEvent(this.searchWrap_,"click",modalClose),this.infiniScroll=this.infiniScroll_?this.infiniScroll_.checked||!!this.infiniScroll_.checked:!0):"visible"===visibility&&(snabbt(this.wrap_,{opacity:.5,fromOpacity:1,easing:"easeOut"}),snabbt(this.searchWrap_,{position:[0,0,0],easing:"easeOut",duration:150}),swapClass(document.body,"emerge",regEmerge),addEvent(this.searchWrap_,"click",modalClose),this.infiniScroll=!1)},isDone:function(done){var answer;return"undefined"==typeof done?answer=this.done:done===!0?(swapClass(document.body,"done",regDone),this.done=done,answer=done):done===!1&&(swapClass(document.body,"failed",regFail),this.done=done,answer=done),answer}}},app=new App;app.resultTemplate=document.getElementById("result-template"),app.relatedTemplate=document.getElementById("related-template"),addEvent(app.send_,"click",function(event){return event&&event.preventDefault?event.preventDefault():event.returnValue=!1,_.trim(app.query_.value)?(swapClass(app.loader_,"loading",regLoad),app.term=_.trim(app.query_.value),sendData(dataResponse,app.term,"content","search",app.placeContent,app.placeMeta,endLoading),!1):(app.query_.focus(),snabbt(app.query_,"attention",{rotation:[0,0,Math.PI/2],springConstant:1.9,springDeacceleration:.9}),!1)}),addEvent(app.query_,"focus",function(){return!1}),addEvent(app.query_,"keypress",function(event){return 13===event.which?(app.send_.click(),!1):void 0}),addEvent(document,"keyup",function(event){27===event.which&&(event.preventDefault?event.preventDefault():event.returnValue=!1,regEmerge.test(document.body.className)&&app.searchToggle("hidden"))}),addEvent(app.moreContent_,"click",more),addEvent(app.moreMeta_,"click",function(event){return event.preventDefault?event.preventDefault():event.returnValue=!1,swapClass(app.loader_,"loading",regLoad),sendData(dataResponse,document.cookie.placeMeta||app.placeMeta?"":app.term,"meta","more",null,document.cookie.placeMeta||app.placeMeta,endLoading),!1}),addEvent(app.searchRestore_,"click",function(event){return event.preventDefault?event.preventDefault():event.returnValue=!1,regEmerge.test(document.body.className)?app.searchToggle("hidden"):(app.searchToggle("visible"),app.query_.value=app.term||"",app.query_.focus()),!1}),addEvent(app.infiniScroll_,"change",infini),addEvent(window,"scroll",scrollWheeler),addEvent(window,"load",function(){app.query_.focus(),""!==window.location.search&&(app.query_.value=decodeURIComponent(window.location.search.slice(3).replace(/\+(?!\%20)/g,"%20")),app.term=_.trim(app.query_.value),app.send_.click());var l=document.createElement("link");l.rel="stylesheet",l.href="//fonts.googleapis.com/css?family=Droid+Serif:400,700|Ubuntu:300,400,700";var h=document.getElementsByTagName("head")[0];h.parentNode.insertBefore(l,h)});