<!DOCTYPE html><html class="no-js" itemscope itemtype="//schema.org/SearchAction"><head><meta charset="utf-8"><meta http-equiv="content-type" content="text/html; charset=UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><title>thatPub</title><meta name="viewport" content="width=device-width,initial-scale=1"><meta name="author" content="//that.pub/humans.txt"><link rel="shortcut icon" href="//that.pub/favicon.ico" type="image/x-icon"><link rel="apple-touch-icon" href="//that.pub/apple-touch-icon.png"><style>@charset "UTF-8";
/* http://meyerweb.com/eric/tools/css/reset/
   v2.0 | 20110126
   License: none (public domain)
*/
html, body, div, span, applet, object, iframe,
h1, h2, h3, h4, h5, h6, p, blockquote, pre,
a, abbr, acronym, address, big, cite, code,
del, dfn, em, img, ins, kbd, q, s, samp,
small, strike, strong, sub, sup, tt, var,
b, u, i, center,
dl, dt, dd, ol, ul, li,
fieldset, form, label, legend,
table, caption, tbody, tfoot, thead, tr, th, td,
article, aside, canvas, details, embed,
figure, figcaption, footer, header, hgroup,
menu, nav, output, ruby, section, summary,
time, mark, audio, video {
  margin: 0;
  padding: 0;
  border: 0;
  font-size: 100%;
  font: inherit;
  vertical-align: baseline;
}

/* HTML5 display-role reset for older browsers */
article, aside, details, figcaption, figure,
footer, header, hgroup, menu, nav, section {
  display: block;
}

body {
  line-height: 1;
}

ol, ul {
  list-style: none;
}

blockquote, q {
  quotes: none;
}

blockquote:before, blockquote:after,
q:before, q:after {
  content: '';
  content: none;
}

table {
  border-collapse: collapse;
  border-spacing: 0;
}

/* ==========================================================================
   Normalize.scss settings
   ========================================================================== */
/**
 * Includes legacy browser support IE6/7
 *
 * Set to false if you want to drop support for IE6 and IE7
 */
/* Base
   ========================================================================== */
/**
 * 1. Set default font family to sans-serif.
 * 2. Prevent iOS text size adjust after orientation change, without disabling
 *  user zoom.
 * 3. Corrects text resizing oddly in IE 6/7 when body `font-size` is set using
 *  `em` units.
 */
html {
  font-family: sans-serif;
  /* 1 */
  -ms-text-size-adjust: 100%;
  /* 2 */
  -webkit-text-size-adjust: 100%;
  /* 2 */
}

/**
 * Remove default margin.
 */
body {
  margin: 0;
}

/* HTML5 display definitions
   ========================================================================== */
/**
 * Correct `block` display not defined for any HTML5 element in IE 8/9.
 * Correct `block` display not defined for `details` or `summary` in IE 10/11
 * and Firefox.
 * Correct `block` display not defined for `main` in IE 11.
 */
article,
aside,
details,
figcaption,
figure,
footer,
header,
hgroup,
main,
menu,
nav,
section,
summary {
  display: block;
}

/**
 * 1. Correct `inline-block` display not defined in IE 6/7/8/9 and Firefox 3.
 * 2. Normalize vertical alignment of `progress` in Chrome, Firefox, and Opera.
 */
audio,
canvas,
progress,
video {
  display: inline-block;
  /* 1 */
  vertical-align: baseline;
  /* 2 */
}

/**
 * Prevents modern browsers from displaying `audio` without controls.
 * Remove excess height in iOS 5 devices.
 */
audio:not([controls]) {
  display: none;
  height: 0;
}

/**
 * Address `[hidden]` styling not present in IE 8/9/10.
 * Hide the `template` element in IE 8/9/11, Safari, and Firefox < 22.
 */
[hidden],
template {
  display: none;
}

/* Links
   ========================================================================== */
/**
 * Remove the gray background color from active links in IE 10.
 */
a {
  background-color: transparent;
}

/**
 * Improve readability when focused and also mouse hovered in all browsers.
 */
a:active, a:hover {
  outline: 0;
}

/* Text-level semantics
   ========================================================================== */
/**
 * Address styling not present in IE 8/9/10/11, Safari, and Chrome.
 */
abbr[title] {
  border-bottom: 1px dotted;
}

/**
 * Address style set to `bolder` in Firefox 4+, Safari, and Chrome.
 */
b,
strong {
  font-weight: bold;
}

/**
 * Address styling not present in Safari and Chrome.
 */
dfn {
  font-style: italic;
}

/**
 * Address variable `h1` font-size and margin within `section` and `article`
 * contexts in Firefox 4+, Safari, and Chrome.
 */
h1 {
  font-size: 2em;
  margin: 0.67em 0;
}

/**
 * Addresses styling not present in IE 8/9.
 */
mark {
  background: #ff0;
  color: #000;
}

/**
 * Address inconsistent and variable font size in all browsers.
 */
small {
  font-size: 75%;
}

/**
 * Prevent `sub` and `sup` affecting `line-height` in all browsers.
 */
sub,
sup {
  font-size: 75%;
  line-height: 0;
  position: relative;
  vertical-align: baseline;
}

sup {
  top: -0.5em;
}

sub {
  bottom: -0.25em;
}

/* Embedded content
   ========================================================================== */
/**
 * 1. Remove border when inside `a` element in IE 8/9/10.
 * 2. Improves image quality when scaled in IE 7.
 */
img {
  border: 0;
}

/**
 * Correct overflow not hidden in IE 9/10/11.
 */
svg:not(:root) {
  overflow: hidden;
}

/* Grouping content
   ========================================================================== */
/**
 * Address margin not present in IE 8/9 and Safari.
 */
figure {
  margin: 1em 40px;
}

/**
 * Address differences between Firefox and other browsers.
 */
hr {
  -moz-box-sizing: content-box;
  box-sizing: content-box;
  height: 0;
}

/**
 * Contain overflow in all browsers.
 */
pre {
  overflow: auto;
}

/**
 * Address odd `em`-unit font size rendering in all browsers.
 * Correct font family set oddly in IE 6, Safari 4/5, and Chrome.
 */
code,
kbd,
pre,
samp {
  font-family: monospace, monospace;
  font-size: 1em;
}

/* Forms
   ========================================================================== */
/**
 * Known limitation: by default, Chrome and Safari on OS X allow very limited
 * styling of `select`, unless a `border` property is set.
 */
/**
 * 1. Correct color not being inherited.
 *  Known issue: affects color of disabled elements.
 * 2. Correct font properties not being inherited.
 * 3. Address margins set differently in Firefox 4+, Safari, and Chrome.
 * 4. Improves appearance and consistency in all browsers.
 */
button,
input,
optgroup,
select,
textarea {
  color: inherit;
  /* 1 */
  font: inherit;
  /* 2 */
  margin: 0;
  /* 3 */
}

/**
 * Address `overflow` set to `hidden` in IE 8/9/10/11.
 */
button {
  overflow: visible;
}

/**
 * Address inconsistent `text-transform` inheritance for `button` and `select`.
 * All other form control elements do not inherit `text-transform` values.
 * Correct `button` style inheritance in Firefox, IE 8/9/10/11, and Opera.
 * Correct `select` style inheritance in Firefox.
 */
button,
select {
  text-transform: none;
}

/**
 * 1. Avoid the WebKit bug in Android 4.0.* where (2) destroys native `audio`
 *  and `video` controls.
 * 2. Correct inability to style clickable `input` types in iOS.
 * 3. Improve usability and consistency of cursor style between image-type
 *  `input` and others.
 * 4. Removes inner spacing in IE 7 without affecting normal text inputs.
 *  Known issue: inner spacing remains in IE 6.
 */
button,
html input[type="button"],
input[type="reset"],
input[type="submit"] {
  -webkit-appearance: button;
  /* 2 */
  cursor: pointer;
  /* 3 */
}

/**
 * Re-set default cursor for disabled elements.
 */
button[disabled],
html input[disabled] {
  cursor: default;
}

/**
 * Remove inner padding and border in Firefox 4+.
 */
button::-moz-focus-inner,
input::-moz-focus-inner {
  border: 0;
  padding: 0;
}

/**
 * Address Firefox 4+ setting `line-height` on `input` using `!important` in
 * the UA stylesheet.
 */
input {
  line-height: normal;
}

/**
 * 1. Address box sizing set to `content-box` in IE 8/9/10.
 * 2. Remove excess padding in IE 8/9/10.
 *  Known issue: excess padding remains in IE 6.
 */
input[type="checkbox"],
input[type="radio"] {
  box-sizing: border-box;
  /* 1 */
  padding: 0;
  /* 2 */
}

/**
 * Fix the cursor style for Chrome's increment/decrement buttons. For certain
 * `font-size` values of the `input`, it causes the cursor style of the
 * decrement button to change from `default` to `text`.
 */
input[type="number"]::-webkit-inner-spin-button,
input[type="number"]::-webkit-outer-spin-button {
  height: auto;
}

/**
 * 1. Address `appearance` set to `searchfield` in Safari and Chrome.
 * 2. Address `box-sizing` set to `border-box` in Safari and Chrome
 *  (include `-moz` to future-proof).
 */
input[type="search"] {
  -webkit-appearance: textfield;
  /* 1 */
  -moz-box-sizing: content-box;
  -webkit-box-sizing: content-box;
  /* 2 */
  box-sizing: content-box;
}

/**
 * Remove inner padding and search cancel button in Safari and Chrome on OS X.
 * Safari (but not Chrome) clips the cancel button when the search input has
 * padding (and `textfield` appearance).
 */
input[type="search"]::-webkit-search-cancel-button,
input[type="search"]::-webkit-search-decoration {
  -webkit-appearance: none;
}

/**
 * Define consistent border, margin, and padding.
 */
fieldset {
  border: 1px solid #c0c0c0;
  margin: 0 2px;
  padding: 0.35em 0.625em 0.75em;
}

/**
 * 1. Correct `color` not being inherited in IE 8/9/10/11.
 * 2. Remove padding so people aren't caught out if they zero out fieldsets.
 * 3. Corrects text not wrapping in Firefox 3.
 * 4. Corrects alignment displayed oddly in IE 6/7.
 */
legend {
  border: 0;
  /* 1 */
  padding: 0;
  /* 2 */
}

/**
 * Remove default vertical scrollbar in IE 8/9/10/11.
 */
textarea {
  overflow: auto;
}

/**
 * Don't inherit the `font-weight` (applied by a rule above).
 * NOTE: the default cannot safely be changed in Chrome and Safari on OS X.
 */
optgroup {
  font-weight: bold;
}

/* Tables
   ========================================================================== */
/**
 * Remove most spacing between table cells.
 */
table {
  border-collapse: collapse;
  border-spacing: 0;
}

td,
th {
  padding: 0;
}

/* Droid Serif, Times New Roman, Times Roman, Times, Georgia, serif; */
/*$heading: Montserrat, Quando, Quicksand, Georgia, Trebuchet MS, serif;*/
h1, h2, h3, h4, h5, h6, label {
  cursor: default;
  font-family: Cantarell, "Open Sans", Georgia, "HelveticaNeue-Light", "Helvetica Neue Light", "Helvetica Neue", Helvetica, sans-serif;
}

.label {
  font-weight: 300;
  text-align: center;
}
.label small {
  color: #AAAAAA;
}

.search-title {
  color: #FF9E00;
  font-family: Cantarell, "Open Sans", Georgia, "HelveticaNeue-Light", "Helvetica Neue Light", "Helvetica Neue", Helvetica, sans-serif;
  font-size: 1.25rem;
  margin: 0 auto;
  position: relative;
  width: 100%;
  text-align: center;
}
@media all and (min-width: 480px) {
  .search-title {
    font-size: 1.75rem;
  }
}

html {
  overflow-y: scroll;
  -webkit-font-smoothing: subpixel-antialiased;
  -moz-osx-font-smoothing: greyscale;
  zoom: 1;
  *zoom: 1;
  margin: 0;
  padding: 0;
  border: 0;
  font-size: 100%;
  font: inherit;
  vertical-align: baseline;
}

html, body {
  min-height: 100%;
  min-width: 100%;
}

*, :after, :before {
  -webkit-box-sizing: border-box !important;
  -moz-box-sizing: border-box !important;
  box-sizing: border-box !important;
}

::-moz-selection {
  background: #b3d4fc;
  text-shadow: none;
}

::selection {
  background: #b3d4fc;
  text-shadow: none;
}

html,
button,
select,
input,
textarea {
  color: #666666;
  outline: 0;
  font-weight: 300;
}

body {
  font-family: Cantarell, "Open Sans", Georgia, "HelveticaNeue-Light", "Helvetica Neue Light", "Helvetica Neue", Helvetica, sans-serif;
  font-size: 15px;
  line-height: 1.5;
  background: #F5F5F5;
}

a {
  color: #FF9E00;
  text-decoration: none;
  border-bottom: 1px solid transparent;
}

q {
  position: relative;
  quotes: "“" "”" "‘" "’";
}
q:before {
  content: open-quote;
}
q:after {
  content: close-quote;
}

hr {
  display: block;
  height: 1px;
  border: 0;
  border-top: 1px solid #ccc;
  margin: 1rem 0;
  padding: 0;
}

audio,
canvas,
img,
video {
  vertical-align: middle;
}

fieldset {
  border: 0;
  margin: 0;
  padding: 0;
}

textarea {
  resize: vertical;
}

.wrapper {
  opacity: 1;
  display: block;
  margin: 0;
}

.full-wrap {
  opacity: 0;
  display: none;
  width: 100%;
  margin: auto;
}
.done .full-wrap {
  display: block;
}
.failed .full-wrap {
  display: none;
}

.page-wrap {
  box-shadow: 0 0 3px rgba(0, 0, 0, 0.25);
  -webkit-border-radius: 4px;
  -moz-border-radius: 4px;
  border-radius: 4px;
  /* WTF Why more?!  Some weird bug on Samsung
     Galaxy S4 Android 4.2 browsers.
       Not exactly a high use-case so remove if desired.*/
  border-left-top-radius: 4px;
  border-right-top-radius: 4px;
  border-right-bottom-radius: 4px;
  border-left-bottom-radius: 4px;
  top: 0;
  background-color: #FEFEFE;
  padding: 2rem 2rem 8rem;
  margin-left: auto;
  margin-right: auto;
  margin-bottom: 3rem;
  margin-top: 3rem;
  border-right: 1px solid #F5F5F5;
  border-left: 1px solid #F5F5F5;
  position: relative;
  display: none;
  width: 90%;
}
.page-wrap:before, .page-wrap:after {
  bottom: 26px;
  box-shadow: 0 28px 8px rgba(0, 0, 0, 0.25);
  content: "";
  height: 28px;
  position: absolute;
  width: 48%;
  z-index: -1;
}
.page-wrap:before {
  left: 2%;
  transform: rotate(-3deg);
}
.page-wrap:after {
  right: 2%;
  transform: rotate(3deg);
}
@media all and (min-width: 768px) {
  .page-wrap {
    margin-bottom: 4rem;
    margin-top: 4rem;
    max-width: 864px;
  }
}
@media all and (min-width: 1140px) {
  .page-wrap {
    width: 100%;
    /* 1140px - 10% for margins */
  }
}
.done .page-wrap {
  display: block;
}
.failed .page-wrap {
  display: none;
}

.ir {
  background-color: transparent;
  border: 0;
  overflow: hidden;
  *text-indent: -9999px;
}

.ir:before {
  content: "";
  display: block;
  width: 0;
  height: 150%;
}

.hidden {
  display: none !important;
  visibility: hidden;
}

.visuallyhidden {
  border: 0;
  clip: rect(0 0 0 0);
  height: 1px;
  margin: -1px;
  overflow: hidden;
  padding: 0;
  position: absolute;
  width: 1px;
}

.visuallyhidden.focusable:active,
.visuallyhidden.focusable:focus {
  clip: auto;
  height: auto;
  margin: 0;
  overflow: visible;
  position: static;
  width: auto;
}

.invisible {
  visibility: hidden;
}

.clearfix {
  *zoom: 1;
}
.clearfix:after {
  clear: both;
}
.clearfix:before, .clearfix:after {
  content: " ";
  display: table;
}

/* .loader {
  @include transform(translate(-50%, 50%));
  display: none;
  position: relative;
  top: 70%;
  left: 50%;
  width: 80%;
  height: 80%;
} */
#loader {
  -webkit-transition: opacity 0.15s ease-out;
  -moz-transition: opacity 0.15s ease-out;
  -o-transition: opacity 0.15s ease-out;
  transition: opacity 0.15s ease-out;
  opacity: 0;
  position: fixed;
  top: 0;
  bottom: 0;
  left: 0;
  right: 0;
  z-index: -10;
}
#loader .spinner {
  display: none;
}

#loader.loading {
  z-index: 4;
  opacity: 1;
  background: #F5F5F5;
}
#loader.loading .spinner {
  display: block;
}

.spinner {
  -ms-transform: translate(-50%, -50%);
  -webkit-transform: translate(-50%, -50%);
  transform: translate(-50%, -50%);
  position: absolute;
  width: 30px;
  height: 30px;
  top: 50%;
  left: 50%;
}
.spinner .blob {
  position: absolute;
  top: 50%;
  left: 50%;
  -ms-transform: translate(-50%, -50%);
  -webkit-transform: translate(-50%, -50%);
  transform: translate(-50%, -50%);
  border: 2px solid #6aa7de;
  width: 10px;
  height: 10px;
  -webkit-border-radius: 4px;
  -moz-border-radius: 4px;
  border-radius: 4px;
  /* WTF Why more?!  Some weird bug on Samsung
     Galaxy S4 Android 4.2 browsers.
       Not exactly a high use-case so remove if desired.*/
  border-left-top-radius: 4px;
  border-right-top-radius: 4px;
  border-right-bottom-radius: 4px;
  border-left-bottom-radius: 4px;
}
.spinner .blob.top {
  top: 0;
  animation: blob-top 1s infinite ease-in;
}
.spinner .blob.bottom {
  top: 100%;
  animation: blob-bottom 1s infinite ease-in;
}
.spinner .blob.left {
  left: 0;
  animation: blob-left 1s infinite ease-in;
}
.spinner .move-blob {
  background: black;
  top: 0;
  animation: blob-spinner-mover 1s infinite ease-in;
}

#no-results {
  display: none;
}

.failed #no-results {
  -ms-transform: translate(-50%, -50%);
  -webkit-transform: translate(-50%, -50%);
  transform: translate(-50%, -50%);
  -webkit-border-radius: 4px;
  -moz-border-radius: 4px;
  border-radius: 4px;
  /* WTF Why more?!  Some weird bug on Samsung
     Galaxy S4 Android 4.2 browsers.
       Not exactly a high use-case so remove if desired.*/
  border-left-top-radius: 4px;
  border-right-top-radius: 4px;
  border-right-bottom-radius: 4px;
  border-left-bottom-radius: 4px;
  z-index: 4;
  font-size: 2.5rem;
  line-height: 1;
  padding: 2rem;
  display: block;
  position: absolute;
  width: 75%;
  top: 50%;
  left: 50%;
  text-align: center;
  border: 1px solid;
}

@keyframes blob-bottom {
  25%, 50%, 75% {
    top: 50%;
    left: 100%;
  }
  100% {
    top: 0;
    left: 50%;
  }
}
@keyframes blob-left {
  25% {
    top: 50%;
    left: 0;
  }
  50%, 100% {
    top: 100%;
    left: 50%;
  }
}
@keyframes blob-top {
  50% {
    top: 0;
    left: 50%;
  }
  75%, 100% {
    top: 50%;
    left: 0;
  }
}
@keyframes blob-spinner-mover {
  0%, 100% {
    top: 0;
    left: 50%;
  }
  25% {
    top: 50%;
    left: 100%;
  }
  50% {
    top: 100%;
    left: 50%;
  }
  75% {
    top: 50%;
    left: 0;
  }
}
.search-wrap {
  -ms-transform: translate3d(0, 0, 0);
  -webkit-transform: translate3d(0, 0, 0);
  transform: translate3d(0, 0, 0);
  position: fixed;
  z-index: 3;
  opacity: 1;
  top: 30%;
  left: 0;
  right: 0;
  bottom: 0;
  max-width: 100%;
  margin: 0;
  width: 100%;
  height: 100%;
  margin-top: 4rem;
}
@media all and (min-width: 540px) {
  .search-wrap {
    top: 0;
  }
}
.done .search-wrap {
  -ms-transform: translate3d(0, -100%, 0);
  -webkit-transform: translate3d(0, -100%, 0);
  transform: translate3d(0, -100%, 0);
  opacity: 0;
  display: block;
  margin-top: 0;
}
.emerge .done .search-wrap {
  -ms-transform: translate3d(0, 0, 0);
  -webkit-transform: translate3d(0, 0, 0);
  transform: translate3d(0, 0, 0);
  z-index: 3;
  opacity: 1;
  width: 100%;
  height: 100%;
}
.failed .search-wrap {
  display: none;
}

.search {
  padding: 1rem;
  display: block;
  margin-left: auto;
  margin-right: auto;
  position: relative;
}
@media all and (min-width: 480px) {
  .search {
    box-shadow: 0 0 3px rgba(0, 0, 0, 0.25);
    -webkit-border-radius: 4px;
    -moz-border-radius: 4px;
    border-radius: 4px;
    /* WTF Why more?!  Some weird bug on Samsung
       Galaxy S4 Android 4.2 browsers.
         Not exactly a high use-case so remove if desired.*/
    border-left-top-radius: 4px;
    border-right-top-radius: 4px;
    border-right-bottom-radius: 4px;
    border-left-bottom-radius: 4px;
    background-color: #FEFEFE;
    width: 28rem;
    bottom: 0;
  }
  .search:before, .search:after {
    bottom: 26px;
    box-shadow: 0 28px 8px rgba(0, 0, 0, 0.25);
    content: "";
    height: 28px;
    position: absolute;
    width: 48%;
    z-index: -1;
  }
  .search:before {
    left: 2%;
    transform: rotate(-3deg);
  }
  .search:after {
    right: 2%;
    transform: rotate(3deg);
  }
}
@media all and (min-width: 768px) {
  .search {
    width: 40rem;
    margin-top: 12rem;
  }
}
.failed .search {
  display: none;
}

.query, .send {
  position: relative;
  display: block;
  float: none;
  clear: both;
  margin: 1rem auto;
  outline: 0;
}

.query {
  -webkit-border-radius: 4px;
  -moz-border-radius: 4px;
  border-radius: 4px;
  /* WTF Why more?!  Some weird bug on Samsung
     Galaxy S4 Android 4.2 browsers.
       Not exactly a high use-case so remove if desired.*/
  border-left-top-radius: 4px;
  border-right-top-radius: 4px;
  border-right-bottom-radius: 4px;
  border-left-bottom-radius: 4px;
  padding: .75rem;
  max-width: 100%;
  outline: 0;
  border: 1px solid #FF9E00;
  background: transparent;
  color: #232323;
  font-size: 1.5rem;
}
.query:focus, .query:active {
  outline: 0;
}
@media all and (min-width: 768px) {
  .query {
    -webkit-border-radius: 4px;
    -moz-border-radius: 4px;
    border-radius: 4px;
    /* WTF Why more?!  Some weird bug on Samsung
       Galaxy S4 Android 4.2 browsers.
         Not exactly a high use-case so remove if desired.*/
    border-left-top-radius: 4px;
    border-right-top-radius: 4px;
    border-right-bottom-radius: 4px;
    border-left-bottom-radius: 4px;
    border-left-color: transparent;
    border-right-color: transparent;
    border-top-color: transparent;
    width: 34rem;
  }
}
.query::-webkit-input-placeholder {
  display: inline;
  width: 100%;
  white-space: normal;
  opacity: .5;
  font-size: inherit;
  /* @media all and (min-width: 768px) {
  } */
}
.query::-moz-input-placeholder {
  display: inline;
  width: 100%;
  white-space: normal;
  opacity: .5;
  font-size: inherit;
  /* @media all and (min-width: 768px) {
  } */
}

.send {
  -webkit-border-radius: 4px;
  -moz-border-radius: 4px;
  border-radius: 4px;
  /* WTF Why more?!  Some weird bug on Samsung
     Galaxy S4 Android 4.2 browsers.
       Not exactly a high use-case so remove if desired.*/
  border-left-top-radius: 4px;
  border-right-top-radius: 4px;
  border-right-bottom-radius: 4px;
  border-left-bottom-radius: 4px;
  display: block;
  color: #FEFEFE;
  position: relative;
  clear: both;
  text-align: center;
  background-color: #FF9E00;
  border: none;
  font-size: 2.25rem;
  margin: 1rem auto 0;
  padding: 0.5rem;
  border-bottom: 1px solid #663f00;
  /*#22313F*/
  border-top: 1px solid white;
  /*#C8F7C5*/
  -ms-transform: translateX(-50%);
  -webkit-transform: translateX(-50%);
  transform: translateX(-50%);
  position: absolute;
  top: 100%;
  left: 50%;
  /* text-shadow: 0 1px 0 $shadow-color; */
  width: 100%;
  max-width: 14rem;
  /* 18rem before */
}
.send:active {
  border-bottom-color: transparent;
  border-top-color: #4d2f00;
}

.search-restore {
  display: none;
}
.no-svg .search-restore svg#ico {
  outline: 0;
  display: none;
  fill: transparent;
  stroke: none;
}
.no-svg .search-restore:after {
  display: inline;
  content: url(img/search.png);
  position: relative;
}
.search-restore #ico {
  -webkit-border-radius: 4px;
  -moz-border-radius: 4px;
  border-radius: 4px;
  /* WTF Why more?!  Some weird bug on Samsung
     Galaxy S4 Android 4.2 browsers.
       Not exactly a high use-case so remove if desired.*/
  border-left-top-radius: 4px;
  border-right-top-radius: 4px;
  border-right-bottom-radius: 4px;
  border-left-bottom-radius: 4px;
  border: 2px solid #FF9E00;
  padding: 8px;
}
.done .search-restore {
  position: fixed;
  display: block;
  width: 3.5rem;
  height: 3.5rem;
  top: 1rem;
  right: 1rem;
  z-index: 3;
}
.done .search-restore svg {
  fill: #FEFEFE;
  background-color: #FF9E00;
}
.done .search-restore:hover svg, .emerge .done .search-restore svg {
  background-color: #FEFEFE;
  fill: #FF9E00;
  stroke: #FF9E00;
}
.done .search-restore:focus, .done .search-restore:active {
  outline: 0;
}

.page-header {
  background-color: #438ED1;
  border-bottom: 2px solid #FEFEFE;
  color: #FEFEFE;
  padding-top: 2rem;
  padding-bottom: 2rem;
}

.results {
  position: relative;
}

.related-label {
  padding: 2rem 1rem 1rem;
  font-size: 1.4rem;
  display: none;
  width: 60%;
  margin-left: auto;
  margin-right: auto;
}
@media all and (min-width: 540px) {
  .related-label {
    font-size: 2rem;
    width: auto;
  }
}
.done .related-label {
  display: block;
}
.failed .related-label {
  display: none;
}

.related {
  position: relative;
  margin: 0 auto;
  padding-bottom: 1rem;
  width: 100%;
  max-width: 864px;
  list-style: none;
  flex-direction: row;
  justify-content: center;
  flex-wrap: wrap;
  border: none;
  /**
   * Turn this off until we can handle
   * the filter on huge amounts of results.
   */
  /*&.sticky {
    @include box-shadow(0, 1px, 6px, 0, $shadow-color);
    position: fixed;
    top: 0;
    left: 0;
    right: 0;
//    height: 3rem;
    background-color: $bg-color;
    //    height: 3rem;
    z-index: 2;
    @media all and (min-width: 768px) {
      padding-right: 5rem;
    }
  }*/
  display: none;
}
@media all and (min-width: 480px) {
  .related {
    width: 90%;
  }
}
.done .related {
  display: flex;
}
.failed .related {
  display: none;
}

.result em {
  color: #205A8F;
  font-style: normal;
  font-weight: 700;
}
.result:nth-child(n) {
  border-bottom: 1px solid #F5F5F5;
}
.result:last-child {
  border-bottom: none;
}

.related .doc {
  -webkit-border-radius: 4px;
  -moz-border-radius: 4px;
  border-radius: 4px;
  /* WTF Why more?!  Some weird bug on Samsung
     Galaxy S4 Android 4.2 browsers.
       Not exactly a high use-case so remove if desired.*/
  border-left-top-radius: 4px;
  border-right-top-radius: 4px;
  border-right-bottom-radius: 4px;
  border-left-bottom-radius: 4px;
  flex-grow: 1;
  text-align: center;
  border: 1px solid transparent;
  font-size: .8rem;
  font-weight: 200;
  padding: 3px 5px;
  /**
   * Turn this off until we can handle
   * the filter on huge amounts of results.
   */
  /*cursor: pointer;*/
}
@media all and (min-width: 480px) {
  .related .doc {
    margin: 5px 1rem 5px 0;
    font-size: 1rem;
  }
}
.related .doc.pretty {
  font-weight: 700;
  border-width: 3px;
}

/* .filtered {
  .doc {
    opacity: .35;
    &.selected {
      opacity: 1;
      &:hover {
        opacity: 1;
      }
    }
    &:hover {
      opacity: .65;
    }
  }
  .content {
    display: none;
    .number {
      display: none;
    }
    .text, .details {
      display: none;
    }
    .info {
      pointer-events: none;
    }
    &.selected {
      display: block;
      .number {
        display: block;
      }
      .text, .details {
        display: block;
      }
      .info {
        pointer-events: all;
      }
    }
  }
} */
.content {
  color: #7F7F7F;
  margin-bottom: 1rem;
  position: relative;
}
.content:hover .info:hover .pub, .content:hover .info:hover .title {
  border-bottom-color: #205A8F;
  /* .filtered & {
    border-bottom-color: transparent;
    .selected & {
      border-bottom-color: $result-color;
    }
  } */
}
.content.pretty .text {
  padding-left: 2rem;
  border-left: 3px solid;
}
@media all and (min-width: 768px) {
  .content {
    padding-left: 3rem;
    padding-right: 3rem;
  }
}

.number {
  background-color: #438ED1;
  color: #FEFEFE;
  font-size: 1.125rem;
  /*font-weight: bold;*/
  border-bottom: 1px solid #438ED1;
  margin: 0;
  padding: .25rem 2.5rem;
  position: absolute;
  top: .75rem;
  font-size: 1rem;
  padding: .25rem 2rem;
  right: 7px;
  margin-right: -1rem;
  /* position: relative;
  overflow: hidden;
  margin: 0 0 0 2rem;
  float: right; */
}
@media all and (min-width: 768px) {
  .number {
    right: 1rem;
    margin-right: 2rem;
  }
}
.number .reveal.climb-up, .number .reveal.look-inside, .number .reveal.do-both {
  display: none;
}
.number:hover {
  /*.climb-up, .look-inside, .do-both {
    @include miniButton($black, .125rem .375rem);
    float: left;
    clear: none;
    margin: auto 2rem auto 0;
    cursor: pointer;
  }*/
}

.text {
  text-rendering: optimizeLegibility;
  color: #666666;
  font-family: Georgia, "HelveticaNeue-Light", "Helvetica Neue Light", "Helvetica Neue", Helvetica, sans-serif;
  position: relative;
  font-size: 1.2rem;
  line-height: 1.7;
  clear: both;
  margin-top: 2rem;
  margin-bottom: 0;
  padding-top: 2rem;
}
.text q:before {
  position: absolute;
  right: 100%;
}
.text q:after {
  position: absolute;
  left: 100%;
}
.text .reveal {
  display: inline-block;
  font-size: .8rem;
  font-family: Cantarell, "Open Sans", Georgia, "HelveticaNeue-Light", "Helvetica Neue Light", "Helvetica Neue", Helvetica, sans-serif;
  border: 1px solid;
  padding: 0.2rem 0.4rem;
  background-color: #205A8F;
  color: #FEFEFE;
  position: relative;
  font-weight: 700;
  margin: 1rem 0;
  /*&:hover {
    background-color: transparent;
    color: $action-color;
  }*/
}
.text .combined {
  display: none;
}
.text .parts {
  display: block;
}
.text.opened .parts {
  display: none;
}
.text.opened .combined {
  display: inline;
}
.text.opened .reveal {
  color: #205A8F;
  background-color: transparent;
  /*&:hover {
    color: $white;
    background-color: $action-color;
  }*/
}
@media all and (min-width: 480px) {
  .text {
    font-size: 1.2rem;
  }
}
@media all and (min-width: 768px) {
  .text {
    font-size: 1.6rem;
    margin-left: auto;
    margin-right: auto;
  }
}
@media all and (min-width: 1140px) {
  .text {
    font-size: 1.4rem;
  }
}

.meta {
  max-width: 100%;
  width: 100%;
  position: relative;
  color: #7F7F7F;
  font-family: Georgia, "HelveticaNeue-Light", "Helvetica Neue Light", "Helvetica Neue", Helvetica, sans-serif;
  font-size: 1rem;
  margin-top: 1rem;
}

.details {
  float: left;
  max-width: 50%;
  overflow: hidden;
  margin-left: 0;
  margin-right: 0;
  text-align: left;
}
.details .chapter, .details .section {
  font-size: .75rem;
}
.details .chapter .title, .details .section .title {
  font-size: .875rem;
}

.info {
  float: right;
  position: relative;
  max-width: 50%;
  overflow: hidden;
  margin-left: 0;
  margin-right: 0;
  text-align: right;
  color: inherit;
  display: block;
}
.info .pub, .info .title {
  border-bottom: 1px solid transparent;
  color: #205A8F;
}
.filtered .info .pub, .filtered .info .title {
  color: inherit;
}
.selected .filtered .info .pub, .selected .filtered .info .title {
  color: #205A8F;
}
.info .pub {
  font-size: 75%;
}
.info .title {
  font-size: .875rem;
}

.more {
  -webkit-border-radius: 4px;
  -moz-border-radius: 4px;
  border-radius: 4px;
  /* WTF Why more?!  Some weird bug on Samsung
     Galaxy S4 Android 4.2 browsers.
       Not exactly a high use-case so remove if desired.*/
  border-left-top-radius: 4px;
  border-right-top-radius: 4px;
  border-right-bottom-radius: 4px;
  border-left-bottom-radius: 4px;
  display: block;
  color: #FEFEFE;
  position: relative;
  clear: both;
  text-align: center;
  background-color: #205A8F;
  border: none;
  font-size: 2.25rem;
  margin: 1rem auto 0;
  padding: 1.25rem;
  border-bottom: 1px solid #040b12;
  /*#22313F*/
  border-top: 1px solid #bed8f0;
  /*#C8F7C5*/
  position: absolute;
  bottom: 2rem;
  display: none;
}
.more:active {
  border-bottom-color: transparent;
  border-top-color: black;
}
.more.content {
  max-width: 90%;
  width: 100%;
  left: 5%;
  right: 5%;
}
.done .more {
  display: block;
}
.failed .more {
  display: none;
}

.summary {
  text-rendering: optimizeLegibility;
  color: #7F7F7F;
  font-weight: 300;
  text-align: center;
  display: none;
  margin: 3rem auto 0;
}
@media all and (min-width: 768px) {
  .summary {
    margin: 4rem auto 0;
  }
}
.done .summary {
  display: block;
}
.failed .summary {
  display: none;
}

.term {
  font-size: 2.5rem;
  color: #2e282a;
}

.total, .count {
  /*color: $action-color;*/
  color: #2e282a;
}

.infini-check {
  display: none;
}
.infini-check input {
  display: none;
}
.done .infini-check {
  display: block;
}
.failed .infini-check {
  display: none;
}

#infini-status {
  -webkit-transition: opacity 0.075s ease-out;
  -moz-transition: opacity 0.075s ease-out;
  -o-transition: opacity 0.075s ease-out;
  transition: opacity 0.075s ease-out;
  pointer-events: none;
  z-index: -1;
  display: table;
  opacity: 0;
  color: #082642;
  max-width: 8rem;
  max-height: 3.2rem;
  width: 100%;
  height: 100%;
}
@media handheld, tablet and (min-width: 480px) {
  #infini-status {
    pointer-events: auto;
    z-index: 2;
    opacity: 1;
  }
  #infini-status:after {
    display: table-cell;
    position: absolute;
    content: 'Infinite Scroll';
    background-color: #FEFEFE;
    word-wrap: normal;
    border: 2px solid;
    border-left: none;
    top: 0;
    left: calc(100% - 2px);
    padding-left: 1rem;
    padding-right: 1rem;
  }
}

.disabled #infini-status {
  color: #AAAAAA;
  pointer-events: none;
  z-index: -1;
  opacity: 0;
}

#infini-label {
  /* @include iconInfini; */
  cursor: pointer;
  position: fixed;
  top: 1rem;
  left: 1rem;
  z-index: 2;
  width: 3.2rem;
  height: 3.2rem;
  display: block;
}
#infini-label svg {
  -webkit-transition: all 0.075s ease-out;
  -moz-transition: all 0.075s ease-out;
  -o-transition: all 0.075s ease-out;
  transition: all 0.075s ease-out;
  position: absolute;
  left: 0;
  top: 0;
}
#infini-label svg path {
  fill: #FEFEFE;
}
#infini-label svg rect {
  fill: #205A8F !important;
  stroke: #205A8F !important;
}
#infini-label:hover {
  /* #infini-status {
    color: $shadow-color;
    opacity: 1;
    &:after {
      border-color: $shadow-color;
    }
  } */
}
#infini-label:hover svg path {
  fill: #AAAAAA;
}
#infini-label:hover svg rect {
  fill: #FEFEFE !important;
  stroke: #AAAAAA !important;
}
#infini-label.disabled svg path {
  fill: #FEFEFE;
}
#infini-label.disabled svg rect {
  fill: #AAAAAA !important;
  stroke: #AAAAAA !important;
}
#infini-label.disabled:hover svg path {
  fill: #205A8F;
}
#infini-label.disabled:hover svg rect {
  fill: #FEFEFE !important;
  stroke: #205A8F !important;
}
#infini-label.disabled:hover #infini-status {
  z-index: -1;
  pointer-events: none;
  opacity: 0;
  color: #205A8F;
}
#infini-label.disabled:hover #infini-status:after {
  border-color: #205A8F;
}
.emerge #infini-label {
  display: block;
  z-index: -1;
  opacity: 0;
}</style></head><body><script type="text/javascript">document.documentElement.removeAttribute("class");</script><!--[if lte IE 9]><p class="browsehappy">You are using an <strong>outdated</strong> browser. Please <a href="http://browsehappy.com/">upgrade your browser</a> to improve your experience.</p><![endif]--><div class="loader" id="loader"><div class="spinner"><div class="blob top"></div><div class="blob bottom"></div><div class="blob left"></div><div class="blob move-blob"></div></div></div><div class="wrapper search-wrap" id="search-wrap"><div class="search" id="search"><header class="search-title"><h1>Find the needle.</h1></header><input name="query" class="query" id="query" placeholder="Ex: dawg msme sgp" autofocus tabindex="0" autocomplete="off" data-control="input"/><noscript><p>Clicking this button is just gonna disappoint you.</p></noscript><a href="#page" class="send" id="send"><span class="action">go</span></a></div></div><a href="#" id="search-restore" class="search-restore" data-control="button"><svg xmlns="http://www.w3.org/2000/svg" enable-background="new 0 0 512 512" height="48" id="ico" version="1.2" viewBox="0 0 512 512" width="48" xml:space="preserve"><path d="M498 498c-19 19-49 19-68 0l-85-85c-35 22-76 36-121 36C100 449 0 348 0 224S100 0 224 0c124 0 224 100 224 224 0 45-13 86-36 121l85 85C517 449 517 479 498 498zM224 64c-89 0-160 72-160 160 0 89 72 160 160 160 89 0 160-72 160-160C385 136 313 64 224 64z"/></svg></a><div class="wrapper full-wrap" id="wrap"><div class="page-header" id="page-header"><h2 class="related-label label">Related Documents</h2><ul class="related" id="related"></ul></div><div class="wrapper summary" id="summary"><h2><q class="term" id="term"></q></h2><h3>showing <span class="count" id="count"></span> of <span class="total" id="total"></span> results</h3></div><div class="wrapper page-wrap" id="page"><a href="#" class="more meta hidden" id="more-meta" data-control="button">fetch »</a><div class="results" id="results"></div><a href="#" class="more content" id="more-content"><span class="action">more, please</span></a></div></div><div class="infini-check"><label for="infini-scroll" class="enabled" id="infini-label" title="Disable infinite scroll"><svg xmlns:svg="http://www.w3.org/2000/svg" xmlns="http://www.w3.org/2000/svg" version="1.1" width="48" height="48"><g transform="translate(0,-1004)"><rect width="46.2" height="46.06" ry="1.894" x="0.959" y="1005" style="fill:none;stroke-linejoin:round;stroke-width:1.922;stroke:#000"/><path d="m27.17 1045c2.19-3 3.83-7 3.83-11 0-1-0.42-1-2.81-1-3.37 0-3.57-1-0.7-4 0 0 0 0 2.4-3 0 0 1.43-2 2.53-3 1.82-2 1.82-2 3.63 0 1.59 2 3.74 5 4.93 6 2.87 3 2.67 4-0.7 4-2.36 0-2.82 0-2.82 1 0 5-5.34 10-10.11 13-2.35 1-2.35 1-0.18-2zM12.8 1034c-1.44-2-1.54-2-1.54-2-1.24-2-3.112-4-3.112-4-2.871-3-2.671-4 0.697-4 2.365 0 2.825 0 2.825-1 0-5 4.09-10 10.68-13 4.35-1 2.83-1-0.39 2-1.81 3-3.83 7-3.84 11 0 1 0.43 1 2.82 1 3.37 0 3.57 1 0.7 4 0 0 0 0-3.12 4-0.62 1 0 0-1.53 2-0.85 1-1.79 2-2.1 2-0.31 0-1.25-1-2.09-2z" fill="#333"/></g></svg> <input type="checkbox" id="infini-scroll" name="infini-scroll" checked="checked" data-control="setting"/> <span id="infini-status"></span></label></div><a href="index.html" id="no-results">No results buddy. Try it again.</a><script type="text/template" id="related-template"><li class="result doc<%= gravitas %>" data-score="<%= score %>" id="<%= key %>">
        <%= key %>
      </li></script><script type="text/template" id="result-template"><div class="result<%= type %><%= gravitas %> clearfix" data-score="<%= score %>" data-pub="<%= fullPub %>">
        <% if ( type === " content" ) { %>
        <div class="text clearfix">
          <% if ( parts && concatText ) { %>
            <span class="combined"><%= concatText %><br/></span>
            <span class="parts"><%  var i = 0, count = parts.length;
                for (; i < count; ++i) {
                  if ( count > 1 || concatText.length > parts[0].length ) { %>
                    <q>...<%= parts[i] %>...</q><br/>
                  <% } else { %>
                    <%= parts[0] %><br/>
                  <% } %>
                <% } %></span>
            <% if ( count > 1 || concatText.length > parts[0].length ) { %><a href="#" class="reveal">expand</a><% } %>
          <% } else { %>
            <span class="combined"><%= rawText %></span>
            <span class="parts"><%= _.trunc(rawText, { length: 100 }) %></span>
            <a href="#" class="reveal">expand</a>
          <% } %>
        </div>
        <h2 class="number">
          <p><%= sub %></p>
          <span class="climb-up reveal">climb up</span>
          <span class="look-inside reveal">look inside</span>
          <span class="do-both reveal">do both</span>
        </h2>
        <div class="meta">
          <div class="details">
            <% if ( details && details.chapter && details.chapterTitle ) { %>
            <span class="chapter">Chapter <%= details.chapter %><br/><span class="title"><%= details.chapterTitle %></span></span><br/>
            <% } if ( details && details.section && details.sectionTitle ) { %>
            <span class="section">Section <%= details.section %><br/><span class="title"><%= details.sectionTitle %></span></span><br/>
            <% } %>
          </div>
          <a class="info" href="<%= url %>" title="<%= date %>" download="<%= fullPub %>.pdf" target="_blank">
            <span class="pub"><%= fullPub %></span><br/>
            <span class="title"><%= title %></span>
          </a>
        </div>
        <% } else { %>
        <a class="info" href="<%= url %>" title="<%= date %>" download="<%= fullPub %>.pdf" target="_blank">
          <span class="pub"><%= fullPub %></span><br/>
          <span class="title"><%= title %></span>
        </a>
        <% } %>
      </div></script><script>(function(root, factory) {
    var snabbt = factory();
    if (typeof exports === "object") {
        module.exports = snabbt;
    } else if (typeof define === "function" && define.amd) {
        define([], function() {
            return root.returnExportsGlobal = snabbt;
        });
    } else {
        root.snabbt = snabbt;
    }
})(this, function() {
    var tickRequests = [];
    var runningAnimations = [];
    var completedAnimations = [];
    var transformProperty = "transform";
    var styles = window.getComputedStyle(document.documentElement, "");
    var vendorPrefix = (Array.prototype.slice.call(styles).join("").match(/-(moz|webkit|ms)-/) || styles.OLink === "" && [ "", "o" ])[1];
    if (vendorPrefix === "webkit") transformProperty = "webkitTransform";
    var snabbt = function(arg1, arg2, arg3) {
        var elements = arg1;
        if (elements.length !== undefined) {
            var aggregateChainer = {
                chainers: [],
                then: function(opts) {
                    console.log("DeprecationWarning: then() is renamed to snabbt()");
                    return this.snabbt(opts);
                },
                snabbt: function(opts) {
                    var len = this.chainers.length;
                    this.chainers.forEach(function(chainer, index) {
                        chainer.snabbt(preprocessOptions(opts, index, len));
                    });
                    return aggregateChainer;
                },
                setValue: function(value) {
                    this.chainers.forEach(function(chainer) {
                        chainer.setValue(value);
                    });
                    return aggregateChainer;
                },
                finish: function() {
                    this.chainers.forEach(function(chainer) {
                        chainer.finish();
                    });
                    return aggregateChainer;
                },
                rollback: function() {
                    this.chainers.forEach(function(chainer) {
                        chainer.rollback();
                    });
                    return aggregateChainer;
                }
            };
            for (var i = 0, len = elements.length; i < len; ++i) {
                if (typeof arg2 == "string") aggregateChainer.chainers.push(snabbtSingleElement(elements[i], arg2, preprocessOptions(arg3, i, len))); else aggregateChainer.chainers.push(snabbtSingleElement(elements[i], preprocessOptions(arg2, i, len), arg3));
            }
            return aggregateChainer;
        } else {
            if (typeof arg2 == "string") return snabbtSingleElement(elements, arg2, preprocessOptions(arg3, 0, 1)); else return snabbtSingleElement(elements, preprocessOptions(arg2, 0, 1), arg3);
        }
    };
    var preprocessOptions = function(options, index, len) {
        if (!options) return options;
        var clone = cloneObject(options);
        if (isFunction(options.delay)) {
            clone.delay = options.delay(index, len);
        }
        if (isFunction(options.callback)) {
            console.log("DeprecationWarning: callback is renamed to complete");
            clone.complete = function() {
                options.callback.call(this, index, len);
            };
        }
        var hasAllDoneCallback = isFunction(options.allDone);
        var hasCompleteCallback = isFunction(options.complete);
        if (hasCompleteCallback || hasAllDoneCallback) {
            clone.complete = function() {
                if (hasCompleteCallback) {
                    options.complete.call(this, index, len);
                }
                if (hasAllDoneCallback && index == len - 1) {
                    options.allDone();
                }
            };
        }
        if (isFunction(options.valueFeeder)) {
            clone.valueFeeder = function(i, matrix) {
                return options.valueFeeder(i, matrix, index, len);
            };
        }
        if (isFunction(options.easing)) {
            clone.easing = function(i) {
                return options.easing(i, index, len);
            };
        }
        var properties = [ "position", "rotation", "skew", "rotationPost", "scale", "width", "height", "opacity", "fromPosition", "fromRotation", "fromSkew", "fromRotationPost", "fromScale", "fromWidth", "fromHeight", "fromOpacity", "transformOrigin", "duration", "delay" ];
        properties.forEach(function(property) {
            if (isFunction(options[property])) {
                clone[property] = options[property](index, len);
            }
        });
        return clone;
    };
    var snabbtSingleElement = function(element, arg2, arg3) {
        if (arg2 === "attention") return setupAttentionAnimation(element, arg3);
        if (arg2 === "stop") return stopAnimation(element);
        var options = arg2;
        clearOphanedEndStates();
        var currentState = currentAnimationState(element);
        var start = currentState;
        start = stateFromOptions(options, start, true);
        var end = cloneObject(currentState);
        end = stateFromOptions(options, end);
        var animOptions = setupAnimationOptions(start, end, options);
        var animation = createAnimation(animOptions);
        runningAnimations.push([ element, animation ]);
        animation.updateElement(element);
        var queue = [];
        var chainer = {
            snabbt: function(opts) {
                queue.unshift(preprocessOptions(opts, 0, 1));
                return chainer;
            },
            then: function(opts) {
                console.log("DeprecationWarning: then() is renamed to snabbt()");
                return this.snabbt(opts);
            }
        };
        function tick(time) {
            animation.tick(time);
            animation.updateElement(element);
            if (animation.isStopped()) return;
            if (!animation.completed()) return queueTick(tick);
            if (options.loop > 1 && !animation.isStopped()) {
                options.loop -= 1;
                animation.restart();
                queueTick(tick);
            } else {
                if (options.complete) {
                    options.complete.call(element);
                }
                if (queue.length) {
                    options = queue.pop();
                    start = stateFromOptions(options, end, true);
                    end = stateFromOptions(options, cloneObject(end));
                    options = setupAnimationOptions(start, end, options);
                    animation = createAnimation(options);
                    runningAnimations.push([ element, animation ]);
                    animation.tick(time);
                    queueTick(tick);
                }
            }
        }
        queueTick(tick);
        if (options.manual) return animation;
        return chainer;
    };
    var setupAttentionAnimation = function(element, options) {
        var movement = stateFromOptions(options);
        options.movement = movement;
        var animation = createAttentionAnimation(options);
        runningAnimations.push([ element, animation ]);
        function tick(time) {
            animation.tick(time);
            animation.updateElement(element);
            if (!animation.completed()) {
                queueTick(tick);
            } else {
                if (options.callback) {
                    options.callback(element);
                }
                if (options.loop && options.loop > 1) {
                    options.loop--;
                    animation.restart();
                    queueTick(tick);
                }
            }
        }
        queueTick(tick);
    };
    var stopAnimation = function(element) {
        for (var i = 0, len = runningAnimations.length; i < len; ++i) {
            var currentAnimation = runningAnimations[i];
            var animatedElement = currentAnimation[0];
            var animation = currentAnimation[1];
            if (animatedElement === element) {
                animation.stop();
            }
        }
    };
    var findAnimationState = function(animationList, element) {
        for (var i = 0, len = animationList.length; i < len; ++i) {
            var currentAnimation = animationList[i];
            var animatedElement = currentAnimation[0];
            var animation = currentAnimation[1];
            if (animatedElement === element) {
                var state = animation.getCurrentState();
                animation.stop();
                return state;
            }
        }
    };
    var clearOphanedEndStates = function() {
        completedAnimations = completedAnimations.filter(function(animation) {
            return findUltimateAncestor(animation[0]).body;
        });
    };
    var findUltimateAncestor = function(node) {
        var ancestor = node;
        while (ancestor.parentNode) {
            ancestor = ancestor.parentNode;
        }
        return ancestor;
    };
    var currentAnimationState = function(element) {
        var state = findAnimationState(runningAnimations, element);
        if (state) return state;
        return findAnimationState(completedAnimations, element);
    };
    var stateFromOptions = function(options, state, useFromPrefix) {
        if (!state) state = createState({});
        var position = "position";
        var rotation = "rotation";
        var skew = "skew";
        var rotationPost = "rotationPost";
        var scale = "scale";
        var width = "width";
        var height = "height";
        var opacity = "opacity";
        if (useFromPrefix) {
            position = "fromPosition";
            rotation = "fromRotation";
            skew = "fromSkew";
            rotationPost = "fromRotationPost";
            scale = "fromScale";
            width = "fromWidth";
            height = "fromHeight";
            opacity = "fromOpacity";
        }
        state.position = optionOrDefault(options[position], state.position);
        state.rotation = optionOrDefault(options[rotation], state.rotation);
        state.rotationPost = optionOrDefault(options[rotationPost], state.rotationPost);
        state.skew = optionOrDefault(options[skew], state.skew);
        state.scale = optionOrDefault(options[scale], state.scale);
        state.opacity = options[opacity];
        state.width = options[width];
        state.height = options[height];
        return state;
    };
    var setupAnimationOptions = function(start, end, options) {
        options.startState = start;
        options.endState = end;
        return options;
    };
    var polyFillrAF = window.requestAnimationFrame || window.webkitRequestAnimationFrame || window.mozRequestAnimationFrame || window.msRequestAnimationFrame || function(callback) {
        return setTimeout(callback, 1e3 / 60);
    };
    var queueTick = function(func) {
        if (tickRequests.length === 0) polyFillrAF(tickAnimations);
        tickRequests.push(func);
    };
    var tickAnimations = function(time) {
        var len = tickRequests.length;
        for (var i = 0; i < len; ++i) {
            tickRequests[i](time);
        }
        tickRequests.splice(0, len);
        var finishedAnimations = runningAnimations.filter(function(animation) {
            return animation[1].completed();
        });
        completedAnimations = completedAnimations.filter(function(animation) {
            for (var i = 0, len = finishedAnimations.length; i < len; ++i) {
                if (animation[0] === finishedAnimations[i][0]) {
                    return false;
                }
            }
            return true;
        });
        completedAnimations = completedAnimations.concat(finishedAnimations);
        runningAnimations = runningAnimations.filter(function(animation) {
            return !animation[1].completed();
        });
        if (tickRequests.length !== 0) polyFillrAF(tickAnimations);
    };
    var createAnimation = function(options) {
        var startState = options.startState;
        var endState = options.endState;
        var duration = optionOrDefault(options.duration, 500);
        var delay = optionOrDefault(options.delay, 0);
        var perspective = options.perspective;
        var easing = createEaser(optionOrDefault(options.easing, "linear"), options);
        var currentState = startState.clone();
        var transformOrigin = options.transformOrigin;
        currentState.transformOrigin = options.transformOrigin;
        var startTime = 0;
        var currentTime = 0;
        var stopped = false;
        var started = false;
        var manual = options.manual;
        var manualValue = 0;
        var manualDelayFactor = delay / duration;
        var manualCallback;
        var tweener;
        if (options.valueFeeder) {
            tweener = createValueFeederTweener(options.valueFeeder, startState, endState, currentState);
        } else {
            tweener = createStateTweener(startState, endState, currentState);
        }
        return {
            stop: function() {
                stopped = true;
            },
            isStopped: function() {
                return stopped;
            },
            finish: function(callback) {
                manual = false;
                var manualDuration = duration * manualValue;
                startTime = currentTime - manualDuration;
                manualCallback = callback;
                easing.resetFrom = manualValue;
            },
            rollback: function(callback) {
                manual = false;
                tweener.setReverse();
                var manualDuration = duration * (1 - manualValue);
                startTime = currentTime - manualDuration;
                manualCallback = callback;
                easing.resetFrom = manualValue;
            },
            restart: function() {
                startTime = undefined;
                easing.resetFrom(0);
            },
            tick: function(time) {
                if (stopped) return;
                if (manual) {
                    currentTime = time;
                    this.updateCurrentTransform();
                    return;
                }
                if (!startTime) {
                    startTime = time;
                }
                if (time - startTime > delay) {
                    started = true;
                    currentTime = time - delay;
                    var curr = Math.min(Math.max(0, currentTime - startTime), duration);
                    easing.tick(curr / duration);
                    this.updateCurrentTransform();
                    if (this.completed() && manualCallback) {
                        manualCallback();
                    }
                }
            },
            getCurrentState: function() {
                return currentState;
            },
            setValue: function(_manualValue) {
                started = true;
                manualValue = Math.min(Math.max(_manualValue, 1e-4), 1 + manualDelayFactor);
            },
            updateCurrentTransform: function() {
                var tweenValue = easing.getValue();
                if (manual) {
                    var val = Math.max(1e-5, manualValue - manualDelayFactor);
                    easing.tick(val);
                    tweenValue = easing.getValue();
                }
                tweener.tween(tweenValue);
            },
            completed: function() {
                if (stopped) return true;
                if (startTime === 0) {
                    return false;
                }
                return easing.completed();
            },
            updateElement: function(element) {
                if (!started) return;
                var matrix = tweener.asMatrix();
                var properties = tweener.getProperties();
                updateElementTransform(element, matrix, perspective);
                updateElementProperties(element, properties);
            }
        };
    };
    var createAttentionAnimation = function(options) {
        var movement = options.movement;
        var currentMovement = createState({});
        options.initialVelocity = .1;
        options.equilibriumPosition = 0;
        var spring = createSpringEasing(options);
        var stopped = false;
        return {
            stop: function() {
                stopped = true;
            },
            isStopped: function(time) {
                return stopped;
            },
            tick: function(time) {
                if (stopped) return;
                if (spring.equilibrium) return;
                spring.tick();
                this.updateMovement();
            },
            updateMovement: function() {
                var value = spring.getValue();
                currentMovement.position[0] = movement.position[0] * value;
                currentMovement.position[1] = movement.position[1] * value;
                currentMovement.position[2] = movement.position[2] * value;
                currentMovement.rotation[0] = movement.rotation[0] * value;
                currentMovement.rotation[1] = movement.rotation[1] * value;
                currentMovement.rotation[2] = movement.rotation[2] * value;
                currentMovement.rotationPost[0] = movement.rotationPost[0] * value;
                currentMovement.rotationPost[1] = movement.rotationPost[1] * value;
                currentMovement.rotationPost[2] = movement.rotationPost[2] * value;
                if (movement.scale[0] !== 1 && movement.scale[1] !== 1) {
                    currentMovement.scale[0] = 1 + movement.scale[0] * value;
                    currentMovement.scale[1] = 1 + movement.scale[1] * value;
                }
                currentMovement.skew[0] = movement.skew[0] * value;
                currentMovement.skew[1] = movement.skew[1] * value;
            },
            updateElement: function(element) {
                updateElementTransform(element, currentMovement.asMatrix());
                updateElementProperties(element, currentMovement.getProperties());
            },
            getCurrentState: function() {
                return currentMovement;
            },
            completed: function() {
                return spring.equilibrium || stopped;
            },
            restart: function() {
                spring = createSpringEasing(options);
            }
        };
    };
    var linearEasing = function(value) {
        return value;
    };
    var ease = function(value) {
        return (Math.cos(value * Math.PI + Math.PI) + 1) / 2;
    };
    var easeIn = function(value) {
        return value * value;
    };
    var easeOut = function(value) {
        return -Math.pow(value - 1, 2) + 1;
    };
    var createSpringEasing = function(options) {
        var position = optionOrDefault(options.startPosition, 0);
        var equilibriumPosition = optionOrDefault(options.equilibriumPosition, 1);
        var velocity = optionOrDefault(options.initialVelocity, 0);
        var springConstant = optionOrDefault(options.springConstant, .8);
        var deceleration = optionOrDefault(options.springDeceleration, .9);
        var mass = optionOrDefault(options.springMass, 10);
        var equilibrium = false;
        return {
            tick: function(value) {
                if (value === 0) return;
                if (equilibrium) return;
                var springForce = -(position - equilibriumPosition) * springConstant;
                var a = springForce / mass;
                velocity += a;
                position += velocity;
                velocity *= deceleration;
                if (Math.abs(position - equilibriumPosition) < .001 && Math.abs(velocity) < .001) {
                    equilibrium = true;
                }
            },
            resetFrom: function(value) {
                position = value;
                velocity = 0;
            },
            getValue: function() {
                if (equilibrium) return equilibriumPosition;
                return position;
            },
            completed: function() {
                return equilibrium;
            }
        };
    };
    var EASING_FUNCS = {
        linear: linearEasing,
        ease: ease,
        easeIn: easeIn,
        easeOut: easeOut
    };
    var createEaser = function(easerName, options) {
        if (easerName == "spring") {
            return createSpringEasing(options);
        }
        var easeFunction = easerName;
        if (!isFunction(easerName)) {
            easeFunction = EASING_FUNCS[easerName];
        }
        var easer = easeFunction;
        var value = 0;
        var lastValue;
        return {
            tick: function(v) {
                value = easer(v);
                lastValue = v;
            },
            resetFrom: function(value) {
                lastValue = 0;
            },
            getValue: function() {
                return value;
            },
            completed: function() {
                if (lastValue >= 1) {
                    return lastValue;
                }
                return false;
            }
        };
    };
    var assignTranslate = function(matrix, x, y, z) {
        matrix[0] = 1;
        matrix[1] = 0;
        matrix[2] = 0;
        matrix[3] = 0;
        matrix[4] = 0;
        matrix[5] = 1;
        matrix[6] = 0;
        matrix[7] = 0;
        matrix[8] = 0;
        matrix[9] = 0;
        matrix[10] = 1;
        matrix[11] = 0;
        matrix[12] = x;
        matrix[13] = y;
        matrix[14] = z;
        matrix[15] = 1;
    };
    var assignRotateX = function(matrix, rad) {
        matrix[0] = 1;
        matrix[1] = 0;
        matrix[2] = 0;
        matrix[3] = 0;
        matrix[4] = 0;
        matrix[5] = Math.cos(rad);
        matrix[6] = -Math.sin(rad);
        matrix[7] = 0;
        matrix[8] = 0;
        matrix[9] = Math.sin(rad);
        matrix[10] = Math.cos(rad);
        matrix[11] = 0;
        matrix[12] = 0;
        matrix[13] = 0;
        matrix[14] = 0;
        matrix[15] = 1;
    };
    var assignRotateY = function(matrix, rad) {
        matrix[0] = Math.cos(rad);
        matrix[1] = 0;
        matrix[2] = Math.sin(rad);
        matrix[3] = 0;
        matrix[4] = 0;
        matrix[5] = 1;
        matrix[6] = 0;
        matrix[7] = 0;
        matrix[8] = -Math.sin(rad);
        matrix[9] = 0;
        matrix[10] = Math.cos(rad);
        matrix[11] = 0;
        matrix[12] = 0;
        matrix[13] = 0;
        matrix[14] = 0;
        matrix[15] = 1;
    };
    var assignRotateZ = function(matrix, rad) {
        matrix[0] = Math.cos(rad);
        matrix[1] = -Math.sin(rad);
        matrix[2] = 0;
        matrix[3] = 0;
        matrix[4] = Math.sin(rad);
        matrix[5] = Math.cos(rad);
        matrix[6] = 0;
        matrix[7] = 0;
        matrix[8] = 0;
        matrix[9] = 0;
        matrix[10] = 1;
        matrix[11] = 0;
        matrix[12] = 0;
        matrix[13] = 0;
        matrix[14] = 0;
        matrix[15] = 1;
    };
    var assignSkew = function(matrix, ax, ay) {
        matrix[0] = 1;
        matrix[1] = Math.tan(ax);
        matrix[2] = 0;
        matrix[3] = 0;
        matrix[4] = Math.tan(ay);
        matrix[5] = 1;
        matrix[6] = 0;
        matrix[7] = 0;
        matrix[8] = 0;
        matrix[9] = 0;
        matrix[10] = 1;
        matrix[11] = 0;
        matrix[12] = 0;
        matrix[13] = 0;
        matrix[14] = 0;
        matrix[15] = 1;
    };
    var assignScale = function(matrix, x, y) {
        matrix[0] = x;
        matrix[1] = 0;
        matrix[2] = 0;
        matrix[3] = 0;
        matrix[4] = 0;
        matrix[5] = y;
        matrix[6] = 0;
        matrix[7] = 0;
        matrix[8] = 0;
        matrix[9] = 0;
        matrix[10] = 1;
        matrix[11] = 0;
        matrix[12] = 0;
        matrix[13] = 0;
        matrix[14] = 0;
        matrix[15] = 1;
    };
    var assignIdentity = function(matrix) {
        matrix[0] = 1;
        matrix[1] = 0;
        matrix[2] = 0;
        matrix[3] = 0;
        matrix[4] = 0;
        matrix[5] = 1;
        matrix[6] = 0;
        matrix[7] = 0;
        matrix[8] = 0;
        matrix[9] = 0;
        matrix[10] = 1;
        matrix[11] = 0;
        matrix[12] = 0;
        matrix[13] = 0;
        matrix[14] = 0;
        matrix[15] = 1;
    };
    var copyArray = function(a, b) {
        b[0] = a[0];
        b[1] = a[1];
        b[2] = a[2];
        b[3] = a[3];
        b[4] = a[4];
        b[5] = a[5];
        b[6] = a[6];
        b[7] = a[7];
        b[8] = a[8];
        b[9] = a[9];
        b[10] = a[10];
        b[11] = a[11];
        b[12] = a[12];
        b[13] = a[13];
        b[14] = a[14];
        b[15] = a[15];
    };
    var createMatrix = function() {
        var data = new Float32Array(16);
        var a = new Float32Array(16);
        var b = new Float32Array(16);
        assignIdentity(data);
        return {
            data: data,
            asCSS: function() {
                var css = "matrix3d(";
                for (var i = 0; i < 15; ++i) {
                    if (Math.abs(data[i]) < 1e-4) css += "0,"; else css += data[i].toFixed(10) + ",";
                }
                if (Math.abs(data[15]) < 1e-4) css += "0)"; else css += data[15].toFixed(10) + ")";
                return css;
            },
            clear: function() {
                assignIdentity(data);
            },
            translate: function(x, y, z) {
                copyArray(data, a);
                assignTranslate(b, x, y, z);
                assignedMatrixMultiplication(a, b, data);
                return this;
            },
            rotateX: function(radians) {
                copyArray(data, a);
                assignRotateX(b, radians);
                assignedMatrixMultiplication(a, b, data);
                return this;
            },
            rotateY: function(radians) {
                copyArray(data, a);
                assignRotateY(b, radians);
                assignedMatrixMultiplication(a, b, data);
                return this;
            },
            rotateZ: function(radians) {
                copyArray(data, a);
                assignRotateZ(b, radians);
                assignedMatrixMultiplication(a, b, data);
                return this;
            },
            scale: function(x, y) {
                copyArray(data, a);
                assignScale(b, x, y);
                assignedMatrixMultiplication(a, b, data);
                return this;
            },
            skew: function(ax, ay) {
                copyArray(data, a);
                assignSkew(b, ax, ay);
                assignedMatrixMultiplication(a, b, data);
                return this;
            }
        };
    };
    var assignedMatrixMultiplication = function(a, b, res) {
        res[0] = a[0] * b[0] + a[1] * b[4] + a[2] * b[8] + a[3] * b[12];
        res[1] = a[0] * b[1] + a[1] * b[5] + a[2] * b[9] + a[3] * b[13];
        res[2] = a[0] * b[2] + a[1] * b[6] + a[2] * b[10] + a[3] * b[14];
        res[3] = a[0] * b[3] + a[1] * b[7] + a[2] * b[11] + a[3] * b[15];
        res[4] = a[4] * b[0] + a[5] * b[4] + a[6] * b[8] + a[7] * b[12];
        res[5] = a[4] * b[1] + a[5] * b[5] + a[6] * b[9] + a[7] * b[13];
        res[6] = a[4] * b[2] + a[5] * b[6] + a[6] * b[10] + a[7] * b[14];
        res[7] = a[4] * b[3] + a[5] * b[7] + a[6] * b[11] + a[7] * b[15];
        res[8] = a[8] * b[0] + a[9] * b[4] + a[10] * b[8] + a[11] * b[12];
        res[9] = a[8] * b[1] + a[9] * b[5] + a[10] * b[9] + a[11] * b[13];
        res[10] = a[8] * b[2] + a[9] * b[6] + a[10] * b[10] + a[11] * b[14];
        res[11] = a[8] * b[3] + a[9] * b[7] + a[10] * b[11] + a[11] * b[15];
        res[12] = a[12] * b[0] + a[13] * b[4] + a[14] * b[8] + a[15] * b[12];
        res[13] = a[12] * b[1] + a[13] * b[5] + a[14] * b[9] + a[15] * b[13];
        res[14] = a[12] * b[2] + a[13] * b[6] + a[14] * b[10] + a[15] * b[14];
        res[15] = a[12] * b[3] + a[13] * b[7] + a[14] * b[11] + a[15] * b[15];
        return res;
    };
    var createState = function(config) {
        var matrix = createMatrix();
        var properties = {
            opacity: undefined,
            width: undefined,
            height: undefined
        };
        return {
            position: optionOrDefault(config.position, [ 0, 0, 0 ]),
            rotation: optionOrDefault(config.rotation, [ 0, 0, 0 ]),
            rotationPost: optionOrDefault(config.rotationPost, [ 0, 0, 0 ]),
            skew: optionOrDefault(config.skew, [ 0, 0 ]),
            scale: optionOrDefault(config.scale, [ 1, 1 ]),
            opacity: config.opacity,
            width: config.width,
            height: config.height,
            clone: function() {
                return createState({
                    position: this.position.slice(0),
                    rotation: this.rotation.slice(0),
                    rotationPost: this.rotationPost.slice(0),
                    skew: this.skew.slice(0),
                    scale: this.scale.slice(0),
                    height: this.height,
                    width: this.width,
                    opacity: this.opacity
                });
            },
            asMatrix: function() {
                var m = matrix;
                m.clear();
                if (this.transformOrigin) m.translate(-this.transformOrigin[0], -this.transformOrigin[1], -this.transformOrigin[2]);
                if (this.scale[0] !== 1 || this.scale[1] !== 1) {
                    m.scale(this.scale[0], this.scale[1]);
                }
                if (this.skew[0] !== 0 || this.skew[1] !== 0) {
                    m.skew(this.skew[0], this.skew[1]);
                }
                if (this.rotation[0] !== 0 || this.rotation[1] !== 0 || this.rotation[2] !== 0) {
                    m.rotateX(this.rotation[0]);
                    m.rotateY(this.rotation[1]);
                    m.rotateZ(this.rotation[2]);
                }
                if (this.position[0] !== 0 || this.position[1] !== 0 || this.position[2] !== 0) {
                    m.translate(this.position[0], this.position[1], this.position[2]);
                }
                if (this.rotationPost[0] !== 0 || this.rotationPost[1] !== 0 || this.rotationPost[2] !== 0) {
                    m.rotateX(this.rotationPost[0]);
                    m.rotateY(this.rotationPost[1]);
                    m.rotateZ(this.rotationPost[2]);
                }
                if (this.transformOrigin) m.translate(this.transformOrigin[0], this.transformOrigin[1], this.transformOrigin[2]);
                return m;
            },
            getProperties: function() {
                properties.opacity = this.opacity;
                properties.width = this.width + "px";
                properties.height = this.height + "px";
                return properties;
            }
        };
    };
    var createStateTweener = function(startState, endState, resultState) {
        var start = startState;
        var end = endState;
        var result = resultState;
        return {
            tween: function(tweenValue) {
                var dX = end.position[0] - start.position[0];
                var dY = end.position[1] - start.position[1];
                var dZ = end.position[2] - start.position[2];
                var dAX = end.rotation[0] - start.rotation[0];
                var dAY = end.rotation[1] - start.rotation[1];
                var dAZ = end.rotation[2] - start.rotation[2];
                var dBX = end.rotationPost[0] - start.rotationPost[0];
                var dBY = end.rotationPost[1] - start.rotationPost[1];
                var dBZ = end.rotationPost[2] - start.rotationPost[2];
                var dSX = end.scale[0] - start.scale[0];
                var dSY = end.scale[1] - start.scale[1];
                var dSkewX = end.skew[0] - start.skew[0];
                var dSkewY = end.skew[1] - start.skew[1];
                var dWidth = end.width - start.width;
                var dHeight = end.height - start.height;
                var dOpacity = end.opacity - start.opacity;
                result.position[0] = start.position[0] + tweenValue * dX;
                result.position[1] = start.position[1] + tweenValue * dY;
                result.position[2] = start.position[2] + tweenValue * dZ;
                result.rotation[0] = start.rotation[0] + tweenValue * dAX;
                result.rotation[1] = start.rotation[1] + tweenValue * dAY;
                result.rotation[2] = start.rotation[2] + tweenValue * dAZ;
                result.rotationPost[0] = start.rotationPost[0] + tweenValue * dBX;
                result.rotationPost[1] = start.rotationPost[1] + tweenValue * dBY;
                result.rotationPost[2] = start.rotationPost[2] + tweenValue * dBZ;
                result.skew[0] = start.skew[0] + tweenValue * dSkewX;
                result.skew[1] = start.skew[1] + tweenValue * dSkewY;
                result.scale[0] = start.scale[0] + tweenValue * dSX;
                result.scale[1] = start.scale[1] + tweenValue * dSY;
                if (end.width !== undefined) result.width = start.width + tweenValue * dWidth;
                if (end.height !== undefined) result.height = start.height + tweenValue * dHeight;
                if (end.opacity !== undefined) result.opacity = start.opacity + tweenValue * dOpacity;
            },
            asMatrix: function() {
                return result.asMatrix();
            },
            getProperties: function() {
                return result.getProperties();
            },
            setReverse: function() {
                var oldStart = start;
                start = end;
                end = oldStart;
            }
        };
    };
    var createValueFeederTweener = function(valueFeeder, startState, endState, resultState) {
        var currentMatrix = valueFeeder(0, createMatrix());
        var start = startState;
        var end = endState;
        var result = resultState;
        var reverse = false;
        return {
            tween: function(tweenValue) {
                if (reverse) tweenValue = 1 - tweenValue;
                currentMatrix.clear();
                currentMatrix = valueFeeder(tweenValue, currentMatrix);
                var dWidth = end.width - start.width;
                var dHeight = end.height - start.height;
                var dOpacity = end.opacity - start.opacity;
                if (end.width !== undefined) result.width = start.width + tweenValue * dWidth;
                if (end.height !== undefined) result.height = start.height + tweenValue * dHeight;
                if (end.opacity !== undefined) result.opacity = start.opacity + tweenValue * dOpacity;
            },
            asMatrix: function() {
                return currentMatrix;
            },
            getProperties: function() {
                return result.getProperties();
            },
            setReverse: function() {
                reverse = true;
            }
        };
    };
    var optionOrDefault = function(option, def) {
        if (typeof option == "undefined") {
            return def;
        }
        return option;
    };
    var updateElementTransform = function(element, matrix, perspective) {
        var cssPerspective = "";
        if (perspective) {
            cssPerspective = "perspective(" + perspective + "px) ";
        }
        var cssMatrix = matrix.asCSS();
        element.style[transformProperty] = cssPerspective + cssMatrix;
    };
    var updateElementProperties = function(element, properties) {
        for (var key in properties) {
            element.style[key] = properties[key];
        }
    };
    var isFunction = function(object) {
        return typeof object === "function";
    };
    var cloneObject = function(object) {
        if (!object) return object;
        var clone = {};
        for (var key in object) {
            clone[key] = object[key];
        }
        return clone;
    };
    if (window.jQuery) {
        (function($) {
            $.fn.snabbt = function(arg1, arg2) {
                return snabbt(this.get(), arg1, arg2);
            };
        })(jQuery);
    }
    snabbt.createMatrix = createMatrix;
    snabbt.setElementTransform = updateElementTransform;
    return snabbt;
});

(function() {
    function Z(a, b, c) {
        if (b !== b) {
            a: {
                b = a.length;
                for (c = (c || 0) - 1; ++c < b; ) {
                    var d = a[c];
                    if (d !== d) {
                        a = c;
                        break a;
                    }
                }
                a = -1;
            }
            return a;
        }
        c = (c || 0) - 1;
        for (d = a.length; ++c < d; ) if (a[c] === b) return c;
        return -1;
    }
    function v(a) {
        return typeof a == "string" ? a : null == a ? "" : a + "";
    }
    function ra(a, b) {
        for (var c = -1, d = a.length; ++c < d && -1 < b.indexOf(a.charAt(c)); ) ;
        return c;
    }
    function sa(a, b) {
        for (var c = a.length; c-- && -1 < b.indexOf(a.charAt(c)); ) ;
        return c;
    }
    function ta(a) {
        return ua[a];
    }
    function va(a) {
        return "\\" + wa[a];
    }
    function t(a) {
        return a && typeof a == "object" || false;
    }
    function $(a) {
        return 160 >= a && 9 <= a && 13 >= a || 32 == a || 160 == a || 5760 == a || 6158 == a || 8192 <= a && (8202 >= a || 8232 == a || 8233 == a || 8239 == a || 8287 == a || 12288 == a || 65279 == a);
    }
    function f() {}
    function aa(a, b, c, d) {
        return typeof a != "undefined" && u.call(d, c) ? a : b;
    }
    function D(a, b, c) {
        var d = E(b);
        if (!c) {
            d || (d = a, a = {});
            c = -1;
            for (var e = d.length; ++c < e; ) {
                var f = d[c];
                a[f] = b[f];
            }
            return a;
        }
        e = -1;
        for (f = d.length; ++e < f; ) {
            var p = d[e], m = a[p], g = c(m, b[p], p, a, b);
            (g === g ? g === m : m !== m) && (typeof m != "undefined" || p in a) || (a[p] = g);
        }
        return a;
    }
    function xa(a) {
        var b, c = 1, d = -1, e = a.length, c = null == c ? 0 : +c || 0;
        0 > c && (c = -c > e ? 0 : e + c);
        b = typeof b == "undefined" || b > e ? e : +b || 0;
        0 > b && (b += e);
        e = c > b ? 0 : b - c >>> 0;
        c >>>= 0;
        for (b = Array(e); ++d < e; ) b[d] = a[d + c];
        return b;
    }
    function ba(a, b) {
        for (var c = -1, d = b.length, e = Array(d); ++c < d; ) e[c] = a[b[c]];
        return e;
    }
    function O(a, b) {
        a = +a;
        b = null == b ? ca : b;
        return -1 < a && 0 == a % 1 && a < b;
    }
    function P(a, b, c) {
        if (!w(c)) return false;
        var d = typeof b;
        "number" == d ? (d = c.length, d = s(d) && O(b, d)) : d = "string" == d && b in c;
        return d && c[b] === a;
    }
    function s(a) {
        return typeof a == "number" && -1 < a && 0 == a % 1 && a <= ca;
    }
    function da(a) {
        for (var b = ea(a), c = b.length, d = c && a.length, e = f.support, e = d && s(d) && (F(a) || e.nonEnumStrings && G(a) || e.nonEnumArgs && H(a)), g = -1, p = []; ++g < c; ) {
            var m = b[g];
            (e && O(m, d) || u.call(a, m)) && p.push(m);
        }
        return p;
    }
    function Q(a, b, c) {
        var d = a ? a.length : 0;
        if (!d) return -1;
        if (typeof c == "number") c = 0 > c ? fa(d + c, 0) : c || 0; else if (c) {
            c = 0;
            d = a ? a.length : c;
            if (typeof b == "number" && b === b && d <= ya) {
                for (;c < d; ) {
                    var e = c + d >>> 1;
                    a[e] < b ? c = e + 1 : d = e;
                }
                c = d;
            } else {
                d = ga;
                c = d(b);
                for (var e = 0, f = a ? a.length : 0, g = c !== c, m = typeof c == "undefined"; e < f; ) {
                    var k = za((e + f) / 2), h = d(a[k]), l = h === h;
                    (g ? l : m ? l && typeof h != "undefined" : h < c) ? e = k + 1 : f = k;
                }
                c = Aa(f, Ba);
            }
            a = a[c];
            return (b === b ? b === a : a !== a) ? c : -1;
        }
        return Z(a, b, c);
    }
    function R(a, b, c) {
        var d = a ? a.length : 0;
        s(d) || (a = ha(a), d = a.length);
        if (!d) return false;
        c = typeof c == "number" ? 0 > c ? fa(d + c, 0) : c || 0 : 0;
        typeof a == "string" || !F(a) && G(a) ? a = c < d && -1 < a.indexOf(b, c) : (d = f.indexOf || Q, 
        d = d === Q ? Z : d, a = -1 < (a ? d(a, b, c) : d));
        return a;
    }
    function H(a) {
        return s(t(a) ? a.length : I) && q.call(a) == ia || false;
    }
    function S(a) {
        return t(a) && typeof a.message == "string" && q.call(a) == T || false;
    }
    function x(a) {
        return typeof a == "function" || false;
    }
    function w(a) {
        var b = typeof a;
        return "function" == b || a && "object" == b || false;
    }
    function A(a) {
        return null == a ? false : q.call(a) == U ? ja.test(Ca.call(a)) : t(a) && (Da(a) ? ja : Ea).test(a) || false;
    }
    function ka(a) {
        return w(a) && q.call(a) == la || false;
    }
    function G(a) {
        return typeof a == "string" || t(a) && q.call(a) == V || false;
    }
    function ea(a) {
        if (null == a) return [];
        w(a) || (a = Object(a));
        for (var b = a.length, c = f.support, b = b && s(b) && (F(a) || c.nonEnumStrings && G(a) || c.nonEnumArgs && H(a)) && b || 0, d = a.constructor, e = -1, d = x(d) && d.prototype || y, k = d === a, p = Array(b), m = 0 < b, n = c.enumErrorProps && (a === J || a instanceof Error), h = c.enumPrototypes && x(a); ++e < b; ) p[e] = e + "";
        for (var l in a) h && "prototype" == l || n && ("message" == l || "name" == l) || m && O(l, b) || "constructor" == l && (k || !u.call(a, l)) || p.push(l);
        if (c.nonEnumShadows && a !== y) for (b = a === Fa ? V : a === J ? T : q.call(a), 
        c = g[b] || g[W], b == W && (d = y), b = X.length; b--; ) l = X[b], e = c[l], k && e || (e ? !u.call(a, l) : a[l] === d[l]) || p.push(l);
        return p;
    }
    function ha(a) {
        return ba(a, E(a));
    }
    function ma(a) {
        return (a = v(a)) && Ga.test(a) ? a.replace(na, "\\$&") : a;
    }
    function oa(a) {
        try {
            return a.apply(I, xa(arguments));
        } catch (b) {
            return S(b) ? b : Error(b);
        }
    }
    function ga(a) {
        return a;
    }
    var I, ia = "[object Arguments]", T = "[object Error]", U = "[object Function]", W = "[object Object]", la = "[object RegExp]", V = "[object String]", Ha = /\b__p\+='';/g, Ia = /\b(__p\+=)''\+/g, Ja = /(__e\(.*?\)|\b__t\))\+'';/g, pa = /[&<>"'`]/g, Ka = RegExp(pa.source), qa = /<%=([\s\S]+?)%>/g, La = /\$\{([^\\}]*(?:\\.[^\\}]*)*)\}/g, Ma = /\w*$/, Ea = /^\[object .+?Constructor\]$/, K = /($^)/, na = /[.*+?^${}()|[\]\/\\]/g, Ga = RegExp(na.source), Na = /\bthis\b/, Oa = /['\n\r\u2028\u2029\\]/g, X = "constructor hasOwnProperty isPrototypeOf propertyIsEnumerable toLocaleString toString valueOf".split(" "), ua = {
        "&": "&amp;",
        "<": "&lt;",
        ">": "&gt;",
        '"': "&quot;",
        "'": "&#39;",
        "`": "&#96;"
    }, r = {
        function: true,
        object: true
    }, wa = {
        "\\": "\\",
        "'": "'",
        "\n": "n",
        "\r": "r",
        "\u2028": "u2028",
        "\u2029": "u2029"
    }, B = r[typeof window] && window !== (this && this.window) ? window : this, C = r[typeof exports] && exports && !exports.nodeType && exports, r = r[typeof module] && module && !module.nodeType && module, n = C && r && typeof global == "object" && global;
    !n || n.global !== n && n.window !== n && n.self !== n || (B = n);
    var n = r && r.exports === C && C, Da = function() {
        try {
            Object({
                toString: 0
            } + "");
        } catch (a) {
            return function() {
                return false;
            };
        }
        return function(a) {
            return typeof a.toString != "function" && typeof (a + "") == "string";
        };
    }(), L = Array.prototype, J = Error.prototype, y = Object.prototype, Fa = String.prototype, Ca = Function.prototype.toString, u = y.hasOwnProperty, q = y.toString, ja = RegExp("^" + ma(q).replace(/toString|(function).*?(?=\\\()| for .+?(?=\\\])/g, "$1.*?") + "$"), za = Math.floor, z = y.propertyIsEnumerable, Pa = L.splice, M = A(M = B.Uint8Array) && M, Y = A(Y = Array.isArray) && Y, N = A(N = Object.keys) && N, fa = Math.max, Aa = Math.min, L = Math.pow(2, 32) - 1, Ba = L - 1, ya = L >>> 1, ca = Math.pow(2, 53) - 1, g = {};
    g["[object Array]"] = g["[object Date]"] = g["[object Number]"] = {
        constructor: true,
        toLocaleString: true,
        toString: true,
        valueOf: true
    };
    g["[object Boolean]"] = g[V] = {
        constructor: true,
        toString: true,
        valueOf: true
    };
    g[T] = g[U] = g[la] = {
        constructor: true,
        toString: true
    };
    g[W] = {
        constructor: true
    };
    (function(a, b) {
        for (var c = -1, d = a.length; ++c < d && false !== b(a[c], c, a); ) ;
        return a;
    })(X, function(a) {
        for (var b in g) if (u.call(g, b)) {
            var c = g[b];
            c[a] = u.call(c, a);
        }
    });
    var k = f.support = {};
    (function(a) {
        function b() {
            this.x = 1;
        }
        var c = {
            0: 1,
            length: 1
        }, d = [];
        b.prototype = {
            valueOf: 1,
            y: 1
        };
        for (var e in new b()) d.push(e);
        k.argsTag = q.call(arguments) == ia;
        k.enumErrorProps = z.call(J, "message") || z.call(J, "name");
        k.enumPrototypes = z.call(b, "prototype");
        k.funcDecomp = !A(B.WinRTError) && Na.test(function() {
            return this;
        });
        k.funcNames = typeof Function.name == "string";
        k.nonEnumStrings = !z.call("x", 0);
        k.nonEnumShadows = !/valueOf/.test(d);
        k.spliceObjects = (Pa.call(c, 0, 1), !c[0]);
        k.unindexedChars = "xx" != "x"[0] + Object("x")[0];
        try {
            k.nonEnumArgs = !z.call(arguments, 1);
        } catch (f) {
            k.nonEnumArgs = true;
        }
    })(0, 0);
    f.templateSettings = {
        escape: /<%-([\s\S]+?)%>/g,
        evaluate: /<%([\s\S]+?)%>/g,
        interpolate: qa,
        variable: "",
        imports: {
            _: f
        }
    };
    k.argsTag || (H = function(a) {
        return s(t(a) ? a.length : I) && u.call(a, "callee") && !z.call(a, "callee") || false;
    });
    var F = Y || function(a) {
        return t(a) && s(a.length) && "[object Array]" == q.call(a) || false;
    };
    if (x(/x/) || M && !x(M)) x = function(a) {
        return q.call(a) == U;
    };
    var E = N ? function(a) {
        if (a) var b = a.constructor, c = a.length;
        return typeof b == "function" && b.prototype === a || (typeof a == "function" ? f.support.enumPrototypes : c && s(c)) ? da(a) : w(a) ? N(a) : [];
    } : da;
    f.keys = E;
    f.keysIn = ea;
    f.values = ha;
    f.attempt = oa;
    f.escape = function(a) {
        return (a = v(a)) && Ka.test(a) ? a.replace(pa, ta) : a;
    };
    f.escapeRegExp = ma;
    f.identity = ga;
    f.includes = R;
    f.indexOf = Q;
    f.isArguments = H;
    f.isArray = F;
    f.isError = S;
    f.isFunction = x;
    f.isNative = A;
    f.isNumber = function(a) {
        return typeof a == "number" || t(a) && "[object Number]" == q.call(a) || false;
    };
    f.isObject = w;
    f.isRegExp = ka;
    f.isString = G;
    f.template = function(a, b, c) {
        var d = f.templateSettings;
        c && P(a, b, c) && (b = c = null);
        a = v(a);
        b = D(D({}, c || b), d, aa);
        c = D(D({}, b.imports), d.imports, aa);
        var e = E(c), g = ba(c, e), k, m, n = 0;
        c = b.interpolate || K;
        var h = "__p+='", l = "sourceURL" in b ? "//# sourceURL=" + b.sourceURL + "\n" : "";
        a.replace(RegExp((b.escape || K).source + "|" + c.source + "|" + (c === qa ? La : K).source + "|" + (b.evaluate || K).source + "|$", "g"), function(b, c, d, e, f, g) {
            d || (d = e);
            h += a.slice(n, g).replace(Oa, va);
            c && (k = true, h += "'+__e(" + c + ")+'");
            f && (m = true, h += "';" + f + ";\n__p+='");
            d && (h += "'+((__t=(" + d + "))==null?'':__t)+'");
            n = g + b.length;
            return b;
        });
        h += "';";
        (b = b.variable) || (h = "with(obj){" + h + "}");
        h = (m ? h.replace(Ha, "") : h).replace(Ia, "$1").replace(Ja, "$1;");
        h = "function(" + (b || "obj") + "){" + (b ? "" : "obj||(obj={});") + "var __t,__p=''" + (k ? ",__e=_.escape" : "") + (m ? ",__j=Array.prototype.join;function print(){__p+=__j.call(arguments,'')}" : ";") + h + "return __p}";
        b = oa(function() {
            return Function(e, l + "return " + h).apply(I, g);
        });
        b.source = h;
        if (S(b)) throw b;
        return b;
    };
    f.trim = function(a, b, c) {
        var d = a;
        a = v(a);
        if (!a) return a;
        if (c ? P(d, b, c) : null == b) {
            for (b = a.length; b-- && $(a.charCodeAt(b)); ) ;
            c = -1;
            for (d = a.length; ++c < d && $(a.charCodeAt(c)); ) ;
            return a.slice(c, b + 1);
        }
        b += "";
        return a.slice(ra(a, b), sa(a, b) + 1);
    };
    f.trunc = function(a, b, c) {
        c && P(a, b, c) && (b = null);
        var d = 30;
        c = "...";
        if (null != b) if (w(b)) {
            var e = "separator" in b ? b.separator : e, d = "length" in b ? +b.length || 0 : d;
            c = "omission" in b ? v(b.omission) : c;
        } else d = +b || 0;
        a = v(a);
        if (d >= a.length) return a;
        d -= c.length;
        if (1 > d) return c;
        b = a.slice(0, d);
        if (null == e) return b + c;
        if (ka(e)) {
            if (a.slice(d).search(e)) {
                var f, g = a.slice(0, d);
                e.global || (e = RegExp(e.source, (Ma.exec(e) || "") + "g"));
                for (e.lastIndex = 0; a = e.exec(g); ) f = a.index;
                b = b.slice(0, null == f ? d : f);
            }
        } else a.indexOf(e, d) != d && (e = b.lastIndexOf(e), -1 < e && (b = b.slice(0, e)));
        return b + c;
    };
    f.contains = R;
    f.include = R;
    f.VERSION = "3.2.0";
    typeof define == "function" && typeof define.amd == "object" && define.amd ? (B._ = f, 
    define(function() {
        return f;
    })) : C && r ? n ? (r.exports = f)._ = f : C._ = f : B._ = f;
}).call(this);

"use strict";

var regPubMatch = /productNo(?:\.exact|\.raw)?(?=\:|$)/, regEmerge = / ?emerge/g, regHidden = / ?hidden/g, regLoad = / ?loading/g, regSelected = / ?selected/g, regFiltered = / ?filtered/g, regOpened = / ?opened/g, regDone = / ?done|$/gm, regFail = / ?failed/g;

function addEvent(element, evt, fnc) {
    return element.addEventListener(evt, fnc, false);
}

function removeEvent(element, evt, fnc) {
    return element.removeEventListener(evt, fnc, false);
}

function swapClass(element, string, regex) {
    if (string !== "") {
        element.className = regex.test(element.className) ? element.className.replace(regex, "") + " " + string : element.className + " " + string;
    } else {
        element.className = element.className.replace(regex, "");
    }
}

String.prototype.toTitle = function() {
    return this.replace(/(?:\W?)\w\S*/g, function(txt) {
        return txt.charAt(0).toUpperCase() + txt.substr(1).toLowerCase();
    });
};

String.prototype.toPubName = function() {
    var removed, count = 0, extraction = [], regQueryPubName = /(?:\b[\-_a-zA-Z]{1,3})?[ \t\-]*(?:(?:[\.\-]|[0-9]+)+)+(?:_?(?:sup|SUP)[A-Za-z]*)?/g, regEOLDashCheck = /[\-\cI\v\0\f]$/m;
    removed = this.replace(regQueryPubName, function(txt) {
        if (extraction && extraction.length > 0 && regEOLDashCheck.test(extraction[count - 1])) {
            extraction[count - 1] += txt.toUpperCase().replace(/\s/g, "");
        } else {
            extraction.push(txt.toUpperCase().replace(/\s/g, ""));
        }
        count += 1;
        return "";
    });
    return {
        extract: extraction,
        remove: removed
    };
};

window.downloader = function(el) {
    var link = document.createElement("a"), file = el.href || el.getAttribute("href") || "";
    if (file === "") {
        return false;
    }
    link.download = el.download || el.getAttribute("download");
    link.href = file;
    link.target = "_blank";
    try {
        link.click();
    } catch (e) {
        try {
            window.open(file);
        } catch (ee) {
            window.location.href = file;
        }
    }
    return false;
};

"use strict";

var App = function() {
    var months = {
        "01": "Jan",
        "02": "Feb",
        "03": "Mar",
        "04": "Apr",
        "05": "May",
        "06": "Jun",
        "07": "Jul",
        "08": "Aug",
        "09": "Sep",
        "10": "Oct",
        "11": "Nov",
        "12": "Dec"
    }, wrap_ = document.getElementById("wrap"), searchWrap_ = document.getElementById("search-wrap"), searchRestore_ = document.getElementById("search-restore"), page_ = document.getElementById("page"), pageHeader_ = document.getElementById("page-header"), results_ = document.getElementById("results"), summary_ = document.getElementById("summary"), count_ = document.getElementById("count"), term_ = document.getElementById("term"), total_ = document.getElementById("total"), query_ = document.getElementById("query"), send_ = document.getElementById("send"), moreMeta_ = document.getElementById("more-meta"), moreContent_ = document.getElementById("more-content"), related_ = document.getElementById("related"), infiniLabel_ = document.getElementById("infini-label"), infiniScroll_ = document.getElementById("infini-scroll"), infiniStatus_ = document.getElementById("infini-status"), loader_ = document.getElementById("loader"), placeContent = document.cookie.placeContent || "", placeMeta = document.cookie.placeMeta || "", bodyRect, relatedRect, resultsRect, relatedOffsetTop, stickyBarPosition;
    CSSStyleSheet.prototype.addCSSRule = function(selector, rules, index) {
        if ("insertRule" in this) {
            this.insertRule(selector + "{" + rules + "}", index);
        } else if ("addRule" in this) {
            this.addRule(selector, rules, index);
        }
    };
    function filterOutliers(someArray) {
        var values = someArray.concat();
        values.sort(function(a, b) {
            return a - b;
        });
        var q1 = values[Math.floor(values.length / 4)];
        var q3 = values[Math.ceil(values.length * (3 / 4))];
        var iqr = q3 - q1;
        var maxValue = q3 + iqr * 1.5;
        return values.filter(function(x) {
            return x > maxValue;
        });
    }
    return {
        wrap_: wrap_,
        searchWrap_: searchWrap_,
        searchRestore_: searchRestore_,
        page_: page_,
        pageHeader_: pageHeader_,
        results_: results_,
        summary_: summary_,
        count_: count_,
        term_: term_,
        total_: total_,
        query_: query_,
        send_: send_,
        moreMeta_: moreMeta_,
        moreContent_: moreContent_,
        related_: related_,
        placeContent: placeContent,
        placeMeta: placeMeta,
        infiniLabel_: infiniLabel_,
        infiniScroll_: infiniScroll_,
        infiniStatus_: infiniStatus_,
        loader_: loader_,
        infiniScroll: true,
        done: false,
        loading: {
            now: false,
            stillMore: false,
            currentHeight: 0
        },
        bodyRect: bodyRect,
        relatedRect: relatedRect,
        resultsRect: resultsRect,
        relatedOffsetTop: relatedOffsetTop,
        stickyBarPosition: stickyBarPosition,
        traveling: false,
        pos: 0,
        term: "",
        scoresContent: [],
        scoresRelatives: [],
        selectedResults: [],
        selectedTotal: 0,
        colors: {},
        dataRender: function(data, allScores) {
            var output = {}, regType = /chapter|section/, index, group, number, fullPub, rawText, text, date, highlights, fileFormat;
            if (!data._source && data.key && data.score) {
                index = _.indexOf(allScores, data.score);
                group = index > -1 ? " match-" + index : "";
                app.colors[data.key] = index;
                output = {
                    url: ("https:" == document.location.protocol ? "https://that.pub/get/" : "http://get.that.pub/") + data.key.toLowerCase() + ".pdf",
                    key: data.key,
                    score: data.score,
                    gravitas: _.contains(filterOutliers(allScores), data.score) || data.score >= 1 ? " pretty" + group : " boring" + group
                };
            } else if (data._source.text) {
                number = data._source.number;
                text = data.highlight["text.english2"];
                rawText = data._source.text;
                fullPub = data._source.productNo;
                highlights = Object.keys(data.highlight);
                fileFormat = data._type !== "form" ? ".pdf" : ".xfdl";
                if (regPubMatch.test(highlights.join(":"))) {
                    fullPub = data.highlight["productNo.exact"] || data.highlight["productNo.raw"] || data.highlight.productNo;
                    fullPub = fullPub.shift();
                }
                date = data._source.releaseDate ? data._source.releaseDate.substring(6, 8) + " " + months[data._source.releaseDate.substring(4, 6)] + " " + data._source.releaseDate.substring(0, 4) : data._source.publishedDate.substring(0, 2) + " " + months[data._source.publishedDate.substring(2, 4)] + " " + data._source.publishedDate.substring(4, 8);
                if (regType.test(data._type) && data._type.length == 7) {
                    number = data._type.toTitle() + " " + data._source.number;
                }
                index = app.colors[data._source.productNo || data._source.pubName];
                group = _.isNumber(index) && (index >= 0 || index < 5) ? " match-" + index : "";
                output = {
                    score: data._score,
                    gravitas: _.contains(filterOutliers(allScores), data._score) || data._score >= 1 ? " pretty" + group : " boring" + group,
                    date: date,
                    url: ("https:" == document.location.protocol ? "https://that.pub/get/" : "http://get.that.pub/") + data._source.productNo.toLowerCase() + fileFormat,
                    fullPub: fullPub,
                    title: data.highlight.title || data._source.title || null,
                    rawTitle: data._source.title,
                    sub: rawText ? number : "",
                    details: {
                        chapter: data._source.chapter && data._source.chapter.number || null,
                        chapterTitle: data.highlight["chapter.title"] || data._source.chapter && data._source.chapter.title || null,
                        section: data._source.section && data._source.section.number || null,
                        sectionTitle: data.highlight["section.title"] || data._source.section && data._source.section.title || null
                    },
                    rawText: rawText,
                    concatText: data.highlight["text"] && data.highlight["text"][0] || null,
                    parts: Array.isArray(text) ? text : null,
                    fileFormat: fileFormat,
                    type: rawText ? " content" : " doc"
                };
            }
            return output || null;
        },
        querySetup: function(term) {
            return function(name) {
                return {
                    term: term,
                    pubName: name.extract,
                    noPubName: name.remove
                };
            }(term.toPubName());
        },
        addItem: function(results, templateCode, allScores) {
            var tmp = "", that = this, rl = results.length, a = 0;
            for (;a < rl; ++a) {
                tmp += _.template(templateCode)(that.dataRender(results[a], allScores));
            }
            return tmp;
        },
        searchToggle: function(visibility) {
            var screenHeight = window.innerHeight;
            if (visibility === "hidden") {
                snabbt(this.searchWrap_, {
                    position: [ 0, -screenHeight, 0 ],
                    opacity: 0,
                    fromOpacity: 1,
                    easing: "easeOut",
                    duration: 250
                });
                snabbt(this.wrap_, {
                    opacity: 1,
                    fromOpacity: 0,
                    easing: "easeOut",
                    delay: 250
                });
                swapClass(document.body, "", regEmerge);
                removeEvent(this.searchWrap_, "click", modalClose);
                this.infiniScroll = this.infiniScroll_ ? this.infiniScroll_.checked || !!this.infiniScroll_.checked : true;
            } else if (visibility === "visible") {
                snabbt(this.wrap_, {
                    opacity: 0,
                    fromOpacity: 1,
                    easing: "easeIn",
                    duration: 250
                });
                snabbt(this.searchWrap_, {
                    position: [ 0, 0, 0 ],
                    opacity: 1,
                    fromOpacity: 0,
                    easing: "easeIn",
                    duration: 250
                });
                swapClass(document.body, "emerge", regEmerge);
                addEvent(this.searchWrap_, "click", modalClose);
                this.infiniScroll = false;
            }
        },
        isDone: function(done) {
            var answer;
            if (typeof done === "undefined") {
                answer = this.done;
            } else if (done === true) {
                swapClass(document.body, "done", regDone);
                this.done = done;
                answer = done;
            } else if (done === false) {
                swapClass(document.body, "failed", regFail);
                this.done = done;
                answer = done;
            }
            return answer;
        }
    };
};

"use strict";

var app = new App();

app.resultTemplate = document.getElementById("result-template");

app.relatedTemplate = document.getElementById("related-template");

function revealText(event) {
    var open = regOpened.test(this.parentNode.className);
    this.innerHTML = "";
    if (!open) {
        swapClass(this.parentNode, "opened", regOpened);
        this.appendChild(document.createTextNode("collapse"));
    } else {
        this.parentNode.className = this.parentNode.className.replace(regOpened, "");
        this.appendChild(document.createTextNode("expand"));
    }
    event.preventDefault();
    return false;
}

function dataResponse(httpRequest, action) {
    var response = JSON.parse(httpRequest.responseText);
    var content = response[0] || null;
    var meta = response[1] || null;
    var expires = new Date(Date.now() + 36e5);
    var a = 0, b = 0, reveals, rl;
    if (content && content.hits.total === 0 && meta && meta.hits.total === 0) {
        return app.isDone(false);
    }
    app.isDone(true);
    expires = expires.toUTCString();
    if (content) {
        var currentContent = content.hits.hits.length;
        app.term_.innerHTML = app.term;
        app.total_.innerHTML = content.hits.total;
        app.placeContent = content._scroll_id;
        document.cookie = "placeContent=" + app.placeContent + "; expires=" + expires;
        if (action !== "more") {
            var currentRelatives = content.aggregations.related_doc.buckets.length;
            window.scroll(0, 0);
            for (;b < currentContent; ++b) {
                app.scoresContent[b] = content.hits.hits[b]._score;
            }
            for (b = 0; b < currentRelatives; ++b) {
                app.scoresContent[b] = content.aggregations.related_doc.buckets[b].score;
            }
            app.related_.innerHTML = app.addItem(content.aggregations.related_doc.buckets, app.relatedTemplate.textContent || app.relatedTemplate.innerText, app.scoresRelatives);
            app.results_.innerHTML = app.addItem(content.hits.hits, app.resultTemplate.textContent || app.resultTemplate.innerText, app.scoresContent);
            app.count_.innerHTML = currentContent;
            app.relatedRect = app.related_.getBoundingClientRect();
            app.bodyRect = document.body.getBoundingClientRect();
            app.stickyBarPosition = Math.abs(app.relatedRect.top) + Math.abs(app.bodyRect.top) + Math.abs(app.relatedRect.height);
        } else {
            var contentGathered = app.scoresContent.length;
            for (b = 0; b < currentContent; ++b) {
                app.scoresContent[b + contentGathered] = content.hits.hits[b]._score;
            }
            app.results_.innerHTML += app.addItem(content.hits.hits, app.resultTemplate.textContent || app.resultTemplate.innerText, app.scoresContent);
            app.count_.innerHTML = app.scoresContent.length;
        }
        reveals = document.querySelectorAll(".text > .reveal");
        rl = reveals.length;
        for (;a < rl; ++a) {
            addEvent(reveals[a], "click", revealText);
        }
        if (content.hits.hits.length < 20) {
            swapClass(app.moreContent_, "hidden", regHidden);
            app.loading.stillMore = false;
        } else {
            swapClass(app.moreContent_, "", regHidden);
            app.loading.stillMore = true;
        }
    }
    if (meta) {
        app.placeMeta = meta._scroll_id;
        document.cookie = "placeMeta=" + app.placeMeta + "; expires=" + expires;
    }
    app.resultsRect = app.results_.getBoundingClientRect();
    app.loading.currentHeight = Math.abs(app.resultsRect.height);
}

function sendData(responder, query, type, action, spot, dot, clbk) {
    var httpRequest = new XMLHttpRequest();
    var url = "https://that.pub/find/" + type + "/" + action;
    httpRequest.onreadystatechange = function() {
        if (httpRequest.readyState === 4) {
            if (httpRequest.status === 200) {
                responder(httpRequest, action);
                clbk(action === "more" ? null : "");
            }
        }
    };
    httpRequest.open("POST", url, true);
    httpRequest.setRequestHeader("Content-type", "application/json");
    httpRequest.send(JSON.stringify({
        t: app.querySetup(query),
        g: spot,
        s: dot
    }));
}

function more(event) {
    if (event && event.preventDefault) {
        event.preventDefault();
    }
    swapClass(app.loader_, "loading", regLoad);
    sendData(dataResponse, document.cookie.placeContent || app.placeContent ? "" : app.term, "content", "more", document.cookie.placeContent || app.placeContent, null, endLoading);
    return false;
}

function modalClose(event) {
    if (event.target === event.currentTarget) {
        app.searchToggle("hidden");
    }
}

function scrollWheeler() {
    var t = document.documentElement || document.body.parentNode, pos = (t && typeof t.ScrollTop === "number" ? t : document.body).ScrollTop || window.pageYOffset, delta = pos - app.pos;
    if (app.infiniScroll === true && app.loading.now === false && app.loading.stillMore === true && delta > 0 && pos > app.loading.currentHeight - 1200) {
        app.loading.now = true;
        more();
    }
    app.pos = pos;
}

function infini() {
    var status, doThis;
    app.infiniScroll = this.checked || !!this.checked;
    status = app.infiniScroll ? "enabled" : "disabled";
    doThis = app.infiniScroll ? "Disable" : "Enable";
    app.infiniLabel_.className = status;
    app.infiniLabel_.setAttribute("title", doThis + " infinite scroll");
    if (!status) {
        this.removeAttribute("checked");
    }
}

function endLoading(el) {
    el = el === null ? app.moreContent_ : el === "" ? app.send_ : null;
    swapClass(app.loader_, "", regLoad);
    app.loading.now = false;
    if (el == app.send_) {
        app.searchToggle("hidden");
    }
}

"use strict";

addEvent(app.send_, "click", function(event) {
    event.preventDefault();
    if (!_.trim(app.query_.value)) {
        app.query_.focus();
        snabbt(app.query_, "attention", {
            rotation: [ 0, 0, Math.PI / 2 ],
            springConstant: 1.9,
            springDeacceleration: .9
        });
        return false;
    }
    swapClass(app.loader_, "loading", regLoad);
    app.term = _.trim(app.query_.value);
    sendData(dataResponse, app.term, "content", "search", app.placeContent, app.placeMeta, endLoading);
    return false;
});

addEvent(app.query_, "focus", function() {
    return false;
});

addEvent(app.query_, "keypress", function(event) {
    if (event.which === 13) {
        app.send_.click();
        return false;
    }
});

addEvent(document, "keyup", function(event) {
    if (event.which === 27) {
        if (event.preventDefault) {
            event.preventDefault();
        } else {
            event.returnValue = false;
        }
        if (regEmerge.test(document.body.className)) {
            app.searchToggle("hidden");
        } else {}
    }
});

addEvent(app.moreContent_, "click", more);

addEvent(app.moreMeta_, "click", function(event) {
    if (event.preventDefault) {
        event.preventDefault();
    } else {
        event.returnValue = false;
    }
    swapClass(app.loader_, "loading", regLoad);
    sendData(dataResponse, document.cookie.placeMeta || app.placeMeta ? "" : app.term, "meta", "more", null, document.cookie.placeMeta || app.placeMeta, endLoading);
    return false;
});

addEvent(app.searchRestore_, "click", function(event) {
    event.preventDefault();
    if (regEmerge.test(document.body.className)) {
        app.searchToggle("hidden");
    } else {
        app.searchToggle("visible");
        app.query_.value = app.term || "";
        app.query_.focus();
    }
    return false;
});

addEvent(app.infiniScroll_, "change", infini);

addEvent(window, "scroll", scrollWheeler);

addEvent(window, "load", function() {
    app.query_.focus();
    var l = document.createElement("link");
    l.rel = "stylesheet";
    l.type = "text/css";
    l.href = "https://fonts.googleapis.com/css?family=Roboto:300,700";
    document.getElementsByTagName("head")[0].appendChild(l);
});
//# sourceMappingURL=script.js.map</script></body></html>